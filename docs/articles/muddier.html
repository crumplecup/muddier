<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>muddier â€¢ muddier</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha256-916EbMg70RQy9LHiGkXzG8hSg9EdNy97GazNG/aiY1w=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha256-eZrrJcwDc/3uDhsdt61sL2oOBY362qM3lon1gyExkL0=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script><!-- sticky kit --><script src="https://cdnjs.cloudflare.com/ajax/libs/sticky-kit/1.1.3/sticky-kit.min.js" integrity="sha256-c4Rlo1ZozqTPE2RLuvbusY3+SU1pQaJC0TjuhygMipw=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="muddier">
<meta property="og:description" content="">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">muddier</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.0.0.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/muddier.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/horsetrader.html">horsetrader</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>muddier</h1>
                        <h4 class="author">Erik Rose</h4>
            
            <h4 class="date">2019-04-06</h4>
      
      
      <div class="hidden name"><code>muddier.Rmd</code></div>

    </div>

    
    
<div id="introduction-to-muddier" class="section level2">
<h2 class="hasAnchor">
<a href="#introduction-to-muddier" class="anchor"></a>Introduction to <code>muddier</code>
</h2>
<p>The package  is inspired by the field of fluvial geomorphology. Correcting for the inhertied ages of radiocarbon-dated charcoal in samples of debris-flow deposits in headwater streams concerns a particular application of deriving a PMF from two parent PMFs through convolution. The functions in  are an attempt to abstract the particulars of the application into a more general set of tools for converting emprical observational data into CDFs, PMFs, and for deriving PMFs from multiple parent PMFs.</p>
</div>
<div id="charcoal-data" class="section level2">
<h2 class="hasAnchor">
<a href="#charcoal-data" class="anchor"></a>Charcoal Data</h2>
<p>The <code>muddier</code> package includes data from Lancaster &amp; Casebeer (2007) on charcoal samples taken from bank stratigraphy adjacent to headwater streams in the OCR. The table <code>charcoal</code> contains site data from the field surveys where they collected the charcoal samples. The table <code>char_pmfs</code> is the radiocarbon age distribution associated with each sample. To load the data, you can use the <code>data</code> function, or simply type <code><a href="https://www.rdocumentation.org/packages/base/topics/library">library(muddier)</a></code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(muddier)

<span class="co"># load package data without loading package</span>
<span class="co"># data(charcoal, package = 'muddier')</span>
<span class="co"># data(char_pmfs, package = 'muddier')</span>

<span class="co"># inspect charcoal table</span>
<span class="kw"><a href="https://www.rdocumentation.org/packages/utils/topics/head">head</a></span>(charcoal)
<span class="co">#&gt;    site_id  family facies         mn rank</span>
<span class="co">#&gt; 1:   BC-52   BC-52     DF -44.878432    1</span>
<span class="co">#&gt; 2:   BC-50   BC-50     DF -34.854693    2</span>
<span class="co">#&gt; 3:   BC-49   BC-49     DF -29.771460    3</span>
<span class="co">#&gt; 4: GRC_102 GRC_102     DF -22.887912    4</span>
<span class="co">#&gt; 5:   BC-31   BC-31     FG  -5.023305    5</span>
<span class="co">#&gt; 6:   GRC-8   GRC-8     FG  -1.462758    6</span></code></pre></div>
<p>The <code>charcoal</code> dataset has 370 observations listed as rows. The rownames of the object and the first column of data are the site ids. At sites where the researchers took multiple samples, the site ids will have letters appended to them (eg. LK-187a, LK-187b, LK-187c). The <code>family</code> column is the site id stripped of any ending letters, so that all observations from the same site share the same family id. Researchers classified the deposit type of samples as fluvial fines (FF), fluvial gravels (FG) and debris-flow deposits (DF). The <code>facies</code> column indicates the facies type using the two-letter classification codes (FF, FG, DF). The <code>mn</code> column is the mean sample age BP as derived from the pmf in <code>char_pmfs</code>, and <code>rank</code> is the ordinal rank of each sample from youngest to oldest.</p>
<p>If we examine the dimensions of each dataset, we see that both have 370 observations, but <code>char_pmfs</code> has 4,430 columns. If we plot the values of a row against the values of the columns names, the result is the age distribution pmf of the sample.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(magrittr)

<span class="co"># compare dimensions of objects</span>
<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/dim">dim</a></span>(charcoal)
<span class="co">#&gt; [1] 370   5</span>
<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/dim">dim</a></span>(char_pmfs)
<span class="co">#&gt; [1]  370 4430</span>

years &lt;-<span class="st"> </span>char_pmfs <span class="op">%&gt;%</span><span class="st"> </span>colnames <span class="op">%&gt;%</span><span class="st"> </span>as.numeric
probs &lt;-<span class="st"> </span>char_pmfs[<span class="dv">250</span>,] <span class="op">%&gt;%</span><span class="st"> </span>as.numeric

<span class="kw"><a href="https://www.rdocumentation.org/packages/graphics/topics/plot">plot</a></span>(years, probs, <span class="dt">xlim=</span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="dv">1000</span>,<span class="dv">1400</span>), <span class="dt">main=</span><span class="st">'pmf of ob# 250'</span>)</code></pre></div>
<p><img src="muddier_files/figure-html/unnamed-chunk-2-1.png" width="700"></p>
<p>To produce these two datasets, I performed several operations on a csv file converted from the Excel file containing the original Lancaster &amp; Casebeer (2007) data. The file used to perform these operations is stored in the <code>data-raw</code> folder on the github reposity for this project. Compared to the original data, this data has been sorted by mean age, and split into two datasets, one for sample variable data and one for numeric pmf vectors associated with each sample.</p>
<p>Before we begin analyzing the data, I would like to verify that the datasets have been sorted correctly, and that the pmfs all sum to 1. First I will make sure the rownames of the two datasets match, then I will test that each row of <code>char_pmfs</code> sums to 1. Finally, I want to make sure the calculated means in <code>charcoal</code> match the means of the pmfs in <code>char_pmfs</code>. To do this, I use the <code>testthat</code> package which employs the function <code>expect_equal</code>. If the two arguments are equal to within a tolerance range, the test passes silently. If the two arguments are not equal, the test fails with a warning. Failure causes abortion of vignette construction, so every time you see a test run in code, that means it has passed. I will explicitly mark unexecuted lines of code with the comment <code># not run</code> at the top of the code snippet.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(testthat)
<span class="co">#&gt; </span>
<span class="co">#&gt; Attaching package: 'testthat'</span>
<span class="co">#&gt; The following objects are masked from 'package:magrittr':</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;     equals, is_less_than, not</span>

<span class="co"># load package data</span>
<span class="kw"><a href="https://www.rdocumentation.org/packages/utils/topics/data">data</a></span>(charcoal, <span class="dt">package =</span> <span class="st">'muddier'</span>)
<span class="kw"><a href="https://www.rdocumentation.org/packages/utils/topics/data">data</a></span>(char_pmfs, <span class="dt">package =</span> <span class="st">'muddier'</span>)

years &lt;-<span class="st"> </span>char_pmfs <span class="op">%&gt;%</span><span class="st"> </span>colnames <span class="op">%&gt;%</span><span class="st"> </span>as.numeric
mns &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/apply">apply</a></span>(char_pmfs, <span class="dv">1</span>, <span class="cf">function</span>(a) <span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/weighted.mean">weighted.mean</a></span>(years, a))


<span class="co"># test rownames are equal</span>
<span class="co"># test means are equal</span>

<span class="kw"><a href="https://www.rdocumentation.org/packages/testthat/topics/test_that">test_that</a></span>(<span class="st">'charcoal and char_pmfs match'</span>, {
  <span class="kw"><a href="https://www.rdocumentation.org/packages/testthat/topics/equality-expectations">expect_equal</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/colnames">rownames</a></span>(charcoal), <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/colnames">rownames</a></span>(char_pmfs))
  <span class="kw"><a href="https://www.rdocumentation.org/packages/testthat/topics/equality-expectations">expect_equal</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/numeric">as.numeric</a></span>(charcoal<span class="op">$</span>mn), <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/numeric">as.numeric</a></span>(mns))
})


<span class="co"># test the pmfs sum to 1</span>
sums &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/apply">apply</a></span>(char_pmfs, <span class="dv">1</span>, sum) <span class="op">%&gt;%</span><span class="st"> </span>as.numeric
ones &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/rep">rep</a></span>(<span class="dv">1</span>, <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/nrow">nrow</a></span>(char_pmfs))
<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/Extremes">max</a></span>(sums<span class="op">-</span>ones)  <span class="co"># examine tolerance</span>
<span class="co">#&gt; [1] 4.51155e-05</span>

<span class="kw"><a href="https://www.rdocumentation.org/packages/testthat/topics/test_that">test_that</a></span>(<span class="st">'pmfs in char_pmfs sum to 1'</span>, {
  <span class="kw"><a href="https://www.rdocumentation.org/packages/testthat/topics/equality-expectations">expect_equal</a></span>(sums, ones, <span class="dt">tolerance =</span> <span class="fl">1e-4</span>)
})</code></pre></div>
<p>Note that the pmfs will not sum exactly to one due to rounding error. First I examine the maximum size of the rounding error with <code><a href="https://www.rdocumentation.org/packages/base/topics/Extremes">max(sums-ones)</a></code>. I explictly set <code>tolerance = 1e-4</code> to ingore this rounding error. Having passed the initial round of tests, I am confident the two datasets are correctly ordered and match, and we can proceed to calculate inherited age.</p>
</div>
<div id="subsetting-sites" class="section level2">
<h2 class="hasAnchor">
<a href="#subsetting-sites" class="anchor"></a>Subsetting sites</h2>
<p><code>charcoal</code> is organized as a data.table to enable simple subsetting operations by the user. The convenient <code>.N</code> term for delineating number of observations is convenient for producing summary statistics, when combined with <code>by</code> indicated the variable for which to count observations. The data.table format allows the user to treat column names as variables when inside brackets, so subsetting a data.table using a logical test is as straightforward as <code>charcoal[facies == 'DF']</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(data.table)

<span class="co"># subset by facies</span>
df_count &lt;-<span class="st"> </span>charcoal[facies <span class="op">==</span><span class="st"> 'DF'</span>, .N, by =<span class="st"> </span>family]
ff_count &lt;-<span class="st"> </span>charcoal[facies <span class="op">==</span><span class="st"> 'FF'</span>, .N, by =<span class="st"> </span>family]
fg_count &lt;-<span class="st"> </span>charcoal[facies <span class="op">==</span><span class="st"> 'FG'</span>, .N, by =<span class="st"> </span>family]

<span class="co"># family ids of sites with &gt; 3 obs</span>
df_count[N<span class="op">&gt;</span><span class="dv">3</span>]
<span class="co">#&gt;     family  N</span>
<span class="co">#&gt; 1: LK_0.16  9</span>
<span class="co">#&gt; 2:  LK_151 10</span>
<span class="co">#&gt; 3: LK_0.42 10</span>
<span class="co">#&gt; 4:   LK_67 10</span>
<span class="co">#&gt; 5:   LK_31  9</span>
<span class="co">#&gt; 6:   UK_53  8</span>
<span class="co">#&gt; 7:  LK_145  6</span>
ff_count[N<span class="op">&gt;</span><span class="dv">3</span>]
<span class="co">#&gt;    family  N</span>
<span class="co">#&gt; 1: LK_118 11</span>
<span class="co">#&gt; 2: LK_148  8</span>
<span class="co">#&gt; 3: LK_187 10</span>
fg_count[N<span class="op">&gt;</span><span class="dv">3</span>]
<span class="co">#&gt;     family  N</span>
<span class="co">#&gt; 1: DFK_140 13</span>
<span class="co">#&gt; 2: DFK_141  8</span>
<span class="co">#&gt; 3:   LK_36  6</span>
<span class="co">#&gt; 4:    UK_1  8</span></code></pre></div>
</div>
<div id="inherited-age" class="section level2">
<h2 class="hasAnchor">
<a href="#inherited-age" class="anchor"></a>Inherited Age</h2>
<p>Inherited age is the age of the charcoal before becoming entrained in bank deposits. By taking multiple samples of a facies type at a single sampling site, Lancaster &amp; Casebeer (2007) were able to estimate a distribution range around inherited age.</p>
<p><code>charcoal</code> is intentionally sorted by rank so that an index of ranks is equivalent to the index of observations by row. Furthermore, the rank number of a sample from <code>charcoal</code> is equivalent to row number of the pmf for the same sample in <code>char_pmfs</code>. Rather than searching by site_id, I have elected to use rank number, and so the function <code><a href="../reference/rank_list.html">rank_list(ftype, dat = charcoal, min_count = 3)</a></code> returns the ranks of observations of a given facies type from <code>dat</code> above a minimum count <code>min_count</code>, with <code>dat</code> set to the charcoal data as a default, and minimum count set to 3.</p>
<p>The concluding test in the snippet tells me that the ranks returned by the function <code><a href="../reference/rank_list.html">rank_list()</a></code> have the same family ids as the subsets in the previous example.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">
df_ranks &lt;-<span class="st"> </span><span class="kw"><a href="../reference/rank_list.html">rank_list</a></span>(<span class="st">'DF'</span>)
ff_ranks &lt;-<span class="st"> </span><span class="kw"><a href="../reference/rank_list.html">rank_list</a></span>(<span class="st">'FF'</span>)
fg_ranks &lt;-<span class="st"> </span><span class="kw"><a href="../reference/rank_list.html">rank_list</a></span>(<span class="st">'FG'</span>)

<span class="co"># inspect output</span>
df_ranks[[<span class="dv">1</span>]]
<span class="co">#&gt; [1]  20  34  36  44  51  55  62  83 153</span>

<span class="co"># family ids pulled by rank</span>
df_by_ranks &lt;-<span class="st"> </span>charcoal[rank <span class="op">%in%</span><span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/unlist">unlist</a></span>(df_ranks), family] <span class="op">%&gt;%</span><span class="st"> </span>factor <span class="op">%&gt;%</span><span class="st"> </span>levels <span class="op">%&gt;%</span><span class="st"> </span>sort
ff_by_ranks &lt;-<span class="st"> </span>charcoal[rank <span class="op">%in%</span><span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/unlist">unlist</a></span>(ff_ranks), family] <span class="op">%&gt;%</span><span class="st"> </span>factor <span class="op">%&gt;%</span><span class="st"> </span>levels <span class="op">%&gt;%</span><span class="st"> </span>sort
fg_by_ranks &lt;-<span class="st"> </span>charcoal[rank <span class="op">%in%</span><span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/unlist">unlist</a></span>(fg_ranks), family] <span class="op">%&gt;%</span><span class="st"> </span>factor <span class="op">%&gt;%</span><span class="st"> </span>levels <span class="op">%&gt;%</span><span class="st"> </span>sort

<span class="co"># family ids pulled by count</span>
df_by_count &lt;-<span class="st"> </span>df_count[N<span class="op">&gt;</span><span class="dv">3</span>,family] <span class="op">%&gt;%</span><span class="st"> </span>unlist <span class="op">%&gt;%</span><span class="st"> </span>sort
ff_by_count &lt;-<span class="st"> </span>ff_count[N<span class="op">&gt;</span><span class="dv">3</span>,family] <span class="op">%&gt;%</span><span class="st"> </span>unlist <span class="op">%&gt;%</span><span class="st"> </span>sort
fg_by_count &lt;-<span class="st"> </span>fg_count[N<span class="op">&gt;</span><span class="dv">3</span>,family] <span class="op">%&gt;%</span><span class="st"> </span>unlist <span class="op">%&gt;%</span><span class="st"> </span>sort

<span class="kw"><a href="https://www.rdocumentation.org/packages/testthat/topics/test_that">test_that</a></span>(<span class="st">'rank list matches family ids'</span>, {
  <span class="kw"><a href="https://www.rdocumentation.org/packages/testthat/topics/equality-expectations">expect_equal</a></span>(df_by_ranks, df_by_count)
  <span class="kw"><a href="https://www.rdocumentation.org/packages/testthat/topics/equality-expectations">expect_equal</a></span>(ff_by_ranks, ff_by_count)
  <span class="kw"><a href="https://www.rdocumentation.org/packages/testthat/topics/equality-expectations">expect_equal</a></span>(fg_by_ranks, fg_by_count)
})</code></pre></div>
<p>I can examine the pmfs associated with a rank list using the function <code><a href="../reference/pmf_by_rank.html">pmf_by_rank(ranks, pmfs = char_pmfs)</a></code>. Because the default argument for <code>pmfs</code> is set to <code>char_pmfs</code>, this second argument can be ommitted in this instance. When passed a vector of ranks to the first argument <code>ranks</code>, <code>pmf_by_rank</code> returns a data.table with pmfs for each rank stored by row, with probabilities stored in columns and year values stored as column names.</p>
<p>When passed a list of rank vectors, as output by <code>rank_list</code>, to the first argument <code>ranks</code>, <code>pmf_by_rank</code> returns a list of data.tables, each containing the pmfs associated with ranks in the rank list, with probabiliites stored in column and year values stored as column names.</p>
<p>To test the functionality of <code>pmf_by_rank</code>, I am mostly concerned that I have inadvertently scrambled the pmfs. I am already highly confident the rows of both datasets match, and the pmfs sum to 1, so now I would like to ensure they are ordered within each family from youngest to oldest.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># return pmfs by rank</span>
df_pmfs &lt;-<span class="st"> </span><span class="kw"><a href="../reference/pmf_by_rank.html">pmf_by_rank</a></span>(df_ranks)
ff_pmfs &lt;-<span class="st"> </span><span class="kw"><a href="../reference/pmf_by_rank.html">pmf_by_rank</a></span>(ff_ranks)
fg_pmfs &lt;-<span class="st"> </span><span class="kw"><a href="../reference/pmf_by_rank.html">pmf_by_rank</a></span>(fg_ranks)

<span class="co"># list wrapper for weighted.mean</span>
get_means &lt;-<span class="st"> </span><span class="cf">function</span>(pmfs, years)  {
  <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/lapply">lapply</a></span>(pmfs, <span class="cf">function</span>(a) <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/lapply">lapply</a></span>(<span class="dv">1</span><span class="op">:</span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/nrow">nrow</a></span>(a), <span class="cf">function</span>(b, c) <span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/weighted.mean">weighted.mean</a></span>(years, c[b,]), <span class="dt">c =</span> a))
}

df_mns &lt;-<span class="st"> </span><span class="kw">get_means</span>(df_pmfs, years)
ff_mns &lt;-<span class="st"> </span><span class="kw">get_means</span>(ff_pmfs, years)
fg_mns &lt;-<span class="st"> </span><span class="kw">get_means</span>(fg_pmfs, years)

<span class="kw"><a href="https://www.rdocumentation.org/packages/testthat/topics/test_that">test_that</a></span>(<span class="st">'pmfs are sorted in ascending age'</span>, {
  <span class="cf">for</span> (i <span class="cf">in</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/seq">seq_along</a></span>(df_mns))  {
    <span class="kw"><a href="https://www.rdocumentation.org/packages/testthat/topics/equality-expectations">expect_equal</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/numeric">as.numeric</a></span>(df_mns[[i]]), <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/sort">sort</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/numeric">as.numeric</a></span>(df_mns[[i]])))
  }
  <span class="cf">for</span> (i <span class="cf">in</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/seq">seq_along</a></span>(ff_mns))  {
    <span class="kw"><a href="https://www.rdocumentation.org/packages/testthat/topics/equality-expectations">expect_equal</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/numeric">as.numeric</a></span>(ff_mns[[i]]), <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/sort">sort</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/numeric">as.numeric</a></span>(ff_mns[[i]])))
  }
  <span class="cf">for</span> (i <span class="cf">in</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/seq">seq_along</a></span>(fg_mns))  {
    <span class="kw"><a href="https://www.rdocumentation.org/packages/testthat/topics/equality-expectations">expect_equal</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/numeric">as.numeric</a></span>(fg_mns[[i]]), <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/sort">sort</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/numeric">as.numeric</a></span>(fg_mns[[i]])))
  }
})</code></pre></div>
<div id="convolving-ages" class="section level3">
<h3 class="hasAnchor">
<a href="#convolving-ages" class="anchor"></a>Convolving Ages</h3>
<p>If we are trying to characterize the distribution of inherited ages from the range of age distributions at a particular site, we can reason that the charcoal in the samples was no older than the youngest piece of charcoal in the set when the samples became entrained as a bank deposit, simply because the youngest sample had to become charcoal before becoming a bank deposit. By this logic, we can characterize the distribution of inherited ages a given site by subtracting the youngest age distribution from the age distribution of each sample via convolution.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">

df_cl &lt;-<span class="st"> </span><span class="kw"><a href="../reference/convo_list.html">convo_list</a></span>(df_ranks)
<span class="co">#&gt; Warning in convo_list(df_ranks): NAs introduced by coercion</span>
ff_cl &lt;-<span class="st"> </span><span class="kw"><a href="../reference/convo_list.html">convo_list</a></span>(ff_ranks)
<span class="co">#&gt; Warning in convo_list(ff_ranks): NAs introduced by coercion</span>
fg_cl &lt;-<span class="st"> </span><span class="kw"><a href="../reference/convo_list.html">convo_list</a></span>(fg_ranks)
<span class="co">#&gt; Warning in convo_list(fg_ranks): NAs introduced by coercion</span>


<span class="co"># </span><span class="al">TESTING</span><span class="co"> CODE #</span>

<span class="co"># although my system issued an NA warning</span>
<span class="co"># a brute force screen shows no NAs produced</span>
<span class="co"># i think it refers to stripped row/col names</span>
screen_for_NAs &lt;-<span class="st"> </span><span class="cf">function</span>(cl)  {
  <span class="cf">for</span> (i <span class="cf">in</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/seq">seq_along</a></span>(cl))  {
    site &lt;-<span class="st"> </span>cl[[i]]
    <span class="cf">for</span> (j <span class="cf">in</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/seq">seq_along</a></span>(site))  {
      ob &lt;-<span class="st"> </span>site[[j]]
      <span class="cf">for</span> (k <span class="cf">in</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/seq">seq_along</a></span>(ob))  {
        <span class="cf">if</span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/NA">is.na</a></span>(ob[k])) <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/print">print</a></span>(i, j, k)
      }
    }
  }
}

<span class="kw">screen_for_NAs</span>(df_cl)
<span class="kw">screen_for_NAs</span>(ff_cl)
<span class="kw">screen_for_NAs</span>(fg_cl)


<span class="co"># slight variation on list wrapper</span>
pmf_means &lt;-<span class="st"> </span><span class="cf">function</span>(pmfs, years)  {
  <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/lapply">lapply</a></span>(pmfs, <span class="cf">function</span>(a) <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/lapply">lapply</a></span>(a, <span class="cf">function</span>(b) <span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/weighted.mean">weighted.mean</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/sort">sort</a></span>(years), b)))
}


dfc_mns &lt;-<span class="st"> </span><span class="kw">pmf_means</span>(df_cl, years)
ffc_mns &lt;-<span class="st"> </span><span class="kw">pmf_means</span>(ff_cl, years)
fgc_mns &lt;-<span class="st"> </span><span class="kw">pmf_means</span>(fg_cl, years)

<span class="kw"><a href="https://www.rdocumentation.org/packages/testthat/topics/test_that">test_that</a></span>(<span class="st">'convolved pmfs are sorted in ascending age'</span>, {
  <span class="cf">for</span> (i <span class="cf">in</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/seq">seq_along</a></span>(dfc_mns))  {
    <span class="kw"><a href="https://www.rdocumentation.org/packages/testthat/topics/equality-expectations">expect_equal</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/numeric">as.numeric</a></span>(dfc_mns[[i]]), <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/sort">sort</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/numeric">as.numeric</a></span>(dfc_mns[[i]])))
  }
  <span class="cf">for</span> (i <span class="cf">in</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/seq">seq_along</a></span>(ffc_mns))  {
    <span class="kw"><a href="https://www.rdocumentation.org/packages/testthat/topics/equality-expectations">expect_equal</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/numeric">as.numeric</a></span>(ffc_mns[[i]]), <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/sort">sort</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/numeric">as.numeric</a></span>(ffc_mns[[i]])))
  }
  <span class="cf">for</span> (i <span class="cf">in</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/seq">seq_along</a></span>(fgc_mns))  {
    <span class="kw"><a href="https://www.rdocumentation.org/packages/testthat/topics/equality-expectations">expect_equal</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/numeric">as.numeric</a></span>(fgc_mns[[i]]), <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/sort">sort</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/numeric">as.numeric</a></span>(fgc_mns[[i]])))
  }
})

<span class="co"># because we convolved the pmfs, check that they sum to 1</span>
get_sums &lt;-<span class="st"> </span><span class="cf">function</span>(pmfs)  {
  <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/apply">apply</a></span>(pmfs, <span class="dv">2</span>, sum)
}

list_sums &lt;-<span class="st"> </span><span class="cf">function</span>(pmfs)  {
  <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/lapply">lapply</a></span>(pmfs, get_sums) <span class="op">%&gt;%</span><span class="st"> </span>unlist <span class="op">%&gt;%</span><span class="st"> </span>as.numeric
}

dfc_sums &lt;-<span class="st"> </span><span class="kw">list_sums</span>(df_cl)
dfc_ones &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/rep">rep</a></span>(<span class="dv">1</span>, <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/length">length</a></span>(dfc_sums))
<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/Extremes">max</a></span>(dfc_sums<span class="op">-</span>dfc_ones)  <span class="co"># examine tolerance</span>
<span class="co">#&gt; [1] 3.542853e-05</span>

ffc_sums &lt;-<span class="st"> </span><span class="kw">list_sums</span>(ff_cl)
ffc_ones &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/rep">rep</a></span>(<span class="dv">1</span>, <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/length">length</a></span>(ffc_sums))

fgc_sums &lt;-<span class="st"> </span><span class="kw">list_sums</span>(fg_cl)
fgc_ones &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/rep">rep</a></span>(<span class="dv">1</span>, <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/length">length</a></span>(fgc_sums))

<span class="kw"><a href="https://www.rdocumentation.org/packages/testthat/topics/test_that">test_that</a></span>(<span class="st">'pmfs in char_pmfs sum to 1'</span>, {
  <span class="kw"><a href="https://www.rdocumentation.org/packages/testthat/topics/equality-expectations">expect_equal</a></span>(dfc_sums, dfc_ones, <span class="dt">tolerance =</span> <span class="fl">1e-4</span>)
  <span class="kw"><a href="https://www.rdocumentation.org/packages/testthat/topics/equality-expectations">expect_equal</a></span>(ffc_sums, ffc_ones, <span class="dt">tolerance =</span> <span class="fl">1e-4</span>)
  <span class="kw"><a href="https://www.rdocumentation.org/packages/testthat/topics/equality-expectations">expect_equal</a></span>(fgc_sums, fgc_ones, <span class="dt">tolerance =</span> <span class="fl">1e-4</span>)
})</code></pre></div>
</div>
<div id="truncation-at-zero" class="section level3">
<h3 class="hasAnchor">
<a href="#truncation-at-zero" class="anchor"></a>Truncation at Zero</h3>
<p>The inherited age convolutions include values below zero. This occurs in the specific case of subtracting the youngest age from itself, which creates a distribution centered on zero, and approximately half of the values in the PMF will be below zero. Because we know that inherited ages must be positive, we can truncate the pmf at zero by setting probabilities at values below zero to zero using the <code>trunc_0</code>. We then need to renormalize the truncated using the <code>normalize</code> function, or we can do both at once using the <code>trunc_norm</code> wrapper.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">
trunc_list &lt;-<span class="st"> </span><span class="cf">function</span>(pmfs, <span class="dt">yrs=</span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/sort">sort</a></span>(years))  {
  <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/lapply">lapply</a></span>(pmfs, <span class="cf">function</span>(a) <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/lapply">lapply</a></span>(a, <span class="cf">function</span>(b) <span class="kw"><a href="../reference/trunc_norm.html">trunc_norm</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/numeric">as.numeric</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/unlist">unlist</a></span>(b)), yrs)))
}

df_trc &lt;-<span class="st"> </span><span class="kw">trunc_list</span>(df_cl)
ff_trc &lt;-<span class="st"> </span><span class="kw">trunc_list</span>(ff_cl)
fg_trc &lt;-<span class="st"> </span><span class="kw">trunc_list</span>(fg_cl)


<span class="co"># </span><span class="al">TESTING</span><span class="co"> CODE #</span>

<span class="co"># test that truncated pmfs do not contain values below zero</span>
<span class="co"># sum probabilities of values below zero in a vector</span>
sum_subzero &lt;-<span class="st"> </span><span class="cf">function</span>(pmf, <span class="dt">index =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/sort">sort</a></span>(years))  {
  pmf &lt;-<span class="st"> </span>pmf <span class="op">%&gt;%</span><span class="st"> </span>unlist <span class="op">%&gt;%</span><span class="st"> </span>as.numeric
  <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/sum">sum</a></span>(pmf[index<span class="op">&lt;</span><span class="dv">0</span>])
}

<span class="co"># list wrapper for sum_subzero</span>
subzero_sum &lt;-<span class="st"> </span><span class="cf">function</span>(pmfs, <span class="dt">index =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/sort">sort</a></span>(years))  {
  <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/lapply">lapply</a></span>(pmfs, <span class="cf">function</span>(a) <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/lapply">lapply</a></span>(a, <span class="cf">function</span>(b) <span class="kw">sum_subzero</span>(b,index))) <span class="op">%&gt;%</span><span class="st"> </span>unlist <span class="op">%&gt;%</span><span class="st"> </span>as.numeric
}

df_szs &lt;-<span class="st"> </span><span class="kw">subzero_sum</span>(df_trc)
ff_szs &lt;-<span class="st"> </span><span class="kw">subzero_sum</span>(ff_trc)
fg_szs &lt;-<span class="st"> </span><span class="kw">subzero_sum</span>(fg_trc)

<span class="co"># vector of zero to compare to for test</span>
df_zs &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/rep">rep</a></span>(<span class="dv">0</span>, <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/length">length</a></span>(df_szs))
ff_zs &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/rep">rep</a></span>(<span class="dv">0</span>, <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/length">length</a></span>(ff_szs))
fg_zs &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/rep">rep</a></span>(<span class="dv">0</span>, <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/length">length</a></span>(fg_szs))

<span class="kw"><a href="https://www.rdocumentation.org/packages/testthat/topics/test_that">test_that</a></span>(<span class="st">'truncated pmfs do not contain values below zero'</span>, {
  <span class="kw"><a href="https://www.rdocumentation.org/packages/testthat/topics/equality-expectations">expect_equal</a></span>(df_szs, df_zs)
  <span class="kw"><a href="https://www.rdocumentation.org/packages/testthat/topics/equality-expectations">expect_equal</a></span>(ff_szs, ff_zs)
  <span class="kw"><a href="https://www.rdocumentation.org/packages/testthat/topics/equality-expectations">expect_equal</a></span>(fg_szs, fg_zs)
})


<span class="co"># test that truncated pmfs are renormalized and sum to one</span>
list_sums &lt;-<span class="st"> </span><span class="cf">function</span>(pmfs)  {
  <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/lapply">lapply</a></span>(pmfs, <span class="cf">function</span>(a) <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/lapply">lapply</a></span>(a, sum)) <span class="op">%&gt;%</span><span class="st"> </span>unlist <span class="op">%&gt;%</span><span class="st"> </span>as.numeric
}

dft_sums &lt;-<span class="st"> </span><span class="kw">list_sums</span>(df_trc)
dft_ones &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/rep">rep</a></span>(<span class="dv">1</span>, <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/length">length</a></span>(dft_sums))
<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/Extremes">max</a></span>(dft_sums<span class="op">-</span>dft_ones)  <span class="co"># examine tolerance</span>
<span class="co">#&gt; [1] 0</span>

fft_sums &lt;-<span class="st"> </span><span class="kw">list_sums</span>(ff_trc)
fft_ones &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/rep">rep</a></span>(<span class="dv">1</span>, <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/length">length</a></span>(fft_sums))

fgt_sums &lt;-<span class="st"> </span><span class="kw">list_sums</span>(fg_trc)
fgt_ones &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/rep">rep</a></span>(<span class="dv">1</span>, <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/length">length</a></span>(fgt_sums))

<span class="kw"><a href="https://www.rdocumentation.org/packages/testthat/topics/test_that">test_that</a></span>(<span class="st">'truncated pmfs are renormalized and sum to 1'</span>, {
  <span class="kw"><a href="https://www.rdocumentation.org/packages/testthat/topics/equality-expectations">expect_equal</a></span>(dft_sums, dft_ones)
  <span class="kw"><a href="https://www.rdocumentation.org/packages/testthat/topics/equality-expectations">expect_equal</a></span>(fft_sums, fft_ones)
  <span class="kw"><a href="https://www.rdocumentation.org/packages/testthat/topics/equality-expectations">expect_equal</a></span>(fgt_sums, fgt_ones)
})</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">df_dt &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/lapply">lapply</a></span>(df_trc, rack) <span class="op">%&gt;%</span><span class="st"> </span>rack <span class="op">%&gt;%</span><span class="st"> </span>rowSums <span class="op">%&gt;%</span><span class="st"> </span>normalize
ff_dt &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/lapply">lapply</a></span>(ff_trc, rack) <span class="op">%&gt;%</span><span class="st"> </span>rack <span class="op">%&gt;%</span><span class="st"> </span>rowSums <span class="op">%&gt;%</span><span class="st"> </span>normalize
fg_dt &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/lapply">lapply</a></span>(fg_trc, rack) <span class="op">%&gt;%</span><span class="st"> </span>rack <span class="op">%&gt;%</span><span class="st"> </span>rowSums <span class="op">%&gt;%</span><span class="st"> </span>normalize

<span class="kw"><a href="https://www.rdocumentation.org/packages/graphics/topics/plot">plot</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/sort">sort</a></span>(years), df_dt, <span class="dt">type =</span> <span class="st">'l'</span>, <span class="dt">lwd =</span> <span class="dv">3</span>, <span class="dt">col =</span> <span class="st">'brown'</span>, <span class="dt">xlim =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="dv">0</span>,<span class="dv">11000</span>), <span class="dt">main =</span> <span class="st">'DF Inherited Age'</span>, <span class="dt">xlab =</span> <span class="st">'inherited age'</span>, <span class="dt">ylab =</span> <span class="st">'pmf'</span>)
<span class="kw"><a href="https://www.rdocumentation.org/packages/graphics/topics/plot">plot</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/sort">sort</a></span>(years), ff_dt, <span class="dt">type =</span> <span class="st">'l'</span>, <span class="dt">lwd =</span> <span class="dv">3</span>, <span class="dt">col =</span> <span class="st">'slateblue'</span>, <span class="dt">xlim =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="dv">0</span>,<span class="dv">4000</span>), <span class="dt">main =</span> <span class="st">'FF Inherited Age'</span>, <span class="dt">xlab =</span> <span class="st">'inherited age'</span>, <span class="dt">ylab =</span> <span class="st">'pmf'</span>)
<span class="kw"><a href="https://www.rdocumentation.org/packages/graphics/topics/plot">plot</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/sort">sort</a></span>(years), fg_dt, <span class="dt">type =</span> <span class="st">'l'</span>, <span class="dt">lwd =</span> <span class="dv">3</span>, <span class="dt">col =</span> <span class="st">'forestgreen'</span>, <span class="dt">xlim =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="dv">0</span>,<span class="dv">10000</span>), <span class="dt">main =</span> <span class="st">'FG Inherited Age'</span>, <span class="dt">xlab =</span> <span class="st">'inherited age'</span>, <span class="dt">ylab =</span> <span class="st">'pmf'</span>)</code></pre></div>
<p><img src="muddier_files/figure-html/unnamed-chunk-9-1.png" width="700"><img src="muddier_files/figure-html/unnamed-chunk-9-2.png" width="700"><img src="muddier_files/figure-html/unnamed-chunk-9-3.png" width="700"></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">df_cdf &lt;-<span class="st"> </span>df_dt <span class="op">%&gt;%</span><span class="st"> </span>to_cdf
ff_cdf &lt;-<span class="st"> </span>ff_dt <span class="op">%&gt;%</span><span class="st"> </span>to_cdf
fg_cdf &lt;-<span class="st"> </span>fg_dt <span class="op">%&gt;%</span><span class="st"> </span>to_cdf

df_exc &lt;-<span class="st"> </span>df_dt <span class="op">%&gt;%</span><span class="st"> </span>to_exceed
ff_exc &lt;-<span class="st"> </span>ff_dt <span class="op">%&gt;%</span><span class="st"> </span>to_exceed
fg_exc &lt;-<span class="st"> </span>fg_dt <span class="op">%&gt;%</span><span class="st"> </span>to_exceed
<span class="co">#&gt; Warning in to_exceed(.): NaNs produced</span>


<span class="kw"><a href="https://www.rdocumentation.org/packages/graphics/topics/plot">plot</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/sort">sort</a></span>(years), df_cdf, <span class="dt">type =</span> <span class="st">'l'</span>, <span class="dt">lwd =</span> <span class="dv">3</span>, <span class="dt">col =</span> <span class="st">'brown'</span>, <span class="dt">xlim =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="dv">0</span>,<span class="dv">11000</span>), <span class="dt">ylim =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="dv">0</span>,<span class="dv">1</span>), <span class="dt">main =</span> <span class="st">'DF Inherited Age'</span>, <span class="dt">xlab =</span> <span class="st">'inherited age'</span>, <span class="dt">ylab =</span> <span class="st">'cdf'</span>)
<span class="kw"><a href="https://www.rdocumentation.org/packages/graphics/topics/plot">plot</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/sort">sort</a></span>(years), df_exc, <span class="dt">type =</span> <span class="st">'l'</span>, <span class="dt">lwd =</span> <span class="dv">3</span>, <span class="dt">col =</span> <span class="st">'brown'</span>, <span class="dt">xlim =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="dv">0</span>,<span class="dv">11000</span>), <span class="dt">main =</span> <span class="st">'DF Inherited Age'</span>, <span class="dt">xlab =</span> <span class="st">'inherited age'</span>, <span class="dt">ylab =</span> <span class="st">'log10 exc'</span>)
<span class="kw"><a href="https://www.rdocumentation.org/packages/graphics/topics/plot">plot</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/sort">sort</a></span>(years), ff_cdf, <span class="dt">type =</span> <span class="st">'l'</span>, <span class="dt">lwd =</span> <span class="dv">3</span>, <span class="dt">col =</span> <span class="st">'slateblue'</span>, <span class="dt">xlim =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="dv">0</span>,<span class="dv">4000</span>), <span class="dt">main =</span> <span class="st">'FF Inherited Age'</span>, <span class="dt">xlab =</span> <span class="st">'inherited age'</span>, <span class="dt">ylab =</span> <span class="st">'cdf'</span>)
<span class="kw"><a href="https://www.rdocumentation.org/packages/graphics/topics/plot">plot</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/sort">sort</a></span>(years), ff_exc, <span class="dt">type =</span> <span class="st">'l'</span>, <span class="dt">lwd =</span> <span class="dv">3</span>, <span class="dt">col =</span> <span class="st">'slateblue'</span>, <span class="dt">xlim =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="dv">0</span>,<span class="dv">4000</span>), <span class="dt">main =</span> <span class="st">'FF Inherited Age'</span>, <span class="dt">xlab =</span> <span class="st">'inherited age'</span>, <span class="dt">ylab =</span> <span class="st">'log10 exc'</span>)
<span class="kw"><a href="https://www.rdocumentation.org/packages/graphics/topics/plot">plot</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/sort">sort</a></span>(years), fg_cdf, <span class="dt">type =</span> <span class="st">'l'</span>, <span class="dt">lwd =</span> <span class="dv">3</span>, <span class="dt">col =</span> <span class="st">'forestgreen'</span>, <span class="dt">xlim =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="dv">0</span>,<span class="dv">10000</span>), <span class="dt">main =</span> <span class="st">'FG Inherited Age'</span>, <span class="dt">xlab =</span> <span class="st">'inherited age'</span>, <span class="dt">ylab =</span> <span class="st">'cdf'</span>)
<span class="kw"><a href="https://www.rdocumentation.org/packages/graphics/topics/plot">plot</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/sort">sort</a></span>(years), fg_exc, <span class="dt">type =</span> <span class="st">'l'</span>, <span class="dt">lwd =</span> <span class="dv">3</span>, <span class="dt">col =</span> <span class="st">'forestgreen'</span>, <span class="dt">xlim =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="dv">0</span>,<span class="dv">10000</span>), <span class="dt">main =</span> <span class="st">'FG Inherited Age'</span>, <span class="dt">xlab =</span> <span class="st">'inherited age'</span>, <span class="dt">ylab =</span> <span class="st">'log10 exc'</span>)</code></pre></div>
<p><img src="muddier_files/figure-html/unnamed-chunk-10-1.png" width="700"><img src="muddier_files/figure-html/unnamed-chunk-10-2.png" width="700"><img src="muddier_files/figure-html/unnamed-chunk-10-3.png" width="700"><img src="muddier_files/figure-html/unnamed-chunk-10-4.png" width="700"><img src="muddier_files/figure-html/unnamed-chunk-10-5.png" width="700"><img src="muddier_files/figure-html/unnamed-chunk-10-6.png" width="700"></p>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#introduction-to-muddier">Introduction to <code>muddier</code></a></li>
      <li><a href="#charcoal-data">Charcoal Data</a></li>
      <li><a href="#subsetting-sites">Subsetting sites</a></li>
      <li><a href="#inherited-age">Inherited Age</a></li>
      </ul>
</div>
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by Erik Rose.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.3.0.</p>
</div>
      </footer>
</div>

  

  </body>
</html>
