<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>summer2019_update • muddier</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha256-916EbMg70RQy9LHiGkXzG8hSg9EdNy97GazNG/aiY1w=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha256-eZrrJcwDc/3uDhsdt61sL2oOBY362qM3lon1gyExkL0=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script><!-- sticky kit --><script src="https://cdnjs.cloudflare.com/ajax/libs/sticky-kit/1.1.3/sticky-kit.min.js" integrity="sha256-c4Rlo1ZozqTPE2RLuvbusY3+SU1pQaJC0TjuhygMipw=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="summer2019_update">
<meta property="og:description" content="">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">muddier</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.0.0.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/muddier.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/horsetrader.html">horsetrader</a>
    </li>
    <li>
      <a href="../articles/summer2019_update.html">summer2019_update</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>summer2019_update</h1>
                        <h4 class="author">Erik Rose</h4>
            
            <h4 class="date">2019-09-05</h4>
      
      
      <div class="hidden name"><code>summer2019_update.Rmd</code></div>

    </div>

    
    
<div id="summer-update" class="section level2">
<h2 class="hasAnchor">
<a href="#summer-update" class="anchor"></a>Summer Update</h2>
<p>This research makes use of delivery probabilities estimated by the Miller/Burnett (MB) model, which I describe in the first section. Second, I detail the process of georeferencing creeeks by matching Lancaster transect survey data to analogous positions in the MB linked node network representation of the channel. Currently I have georeferenced Bear Creek and Knolwes Creek, while georeferences for Cedar, Hoffman and Golden Ridge Creeks should be forthcoming in the next few weeks. For radiocarbon sample data, I describe the process of estimating deposit age by subtracting the inherited age distribution from the sample age via convolution. Then we examine delivery probabilities in relation to cross-sectional area and valley width, and consider a number of weighting functions to calibrate MB probabilities using empiric deposition data from the Lancaster surveys.</p>
<p>Knowles Creek was the first creek I georeferenced because it was the largest transect record in the Lancaster dataset, and once I had a single creek I focused on the process of weighting delivery probabilities using the Lancaster data as a proof of concept. When adding Bear Creek to the dataset, I made several improvements to the georeferencing process by condensing code repetition into utility functions, so I am optimistic additional creek data will be forthcoming. Now that we can examine weighting functions from a couple creeks, we can start to deliberate the relative merits and weaknesses of different potential weights. Ultimately the goal is to improve the predictive accuracy of MB delivery probabilities by use of a weighting function derived from an empiric field record of deposits.</p>
<p>The additions of Cedar Creek and Golden Ridge Creek to the dataset are necessary to include georeferences for all radiocarbon sample sites. The radiocarbon data includes diagrams of stratigraphy columns at the sample site, with layers classified as debris flows, fluvial fines and fluvial gravels and quantified in proportion to bank height. This permits us to weight delivery probabilities by fraction debris flow, and combined with the transect data allows us to infer the volume of debris flows at sample sites. We can describe flux in detail at sample sites by ascribing the residence time of the sample to the inferred volume.</p>
</div>
<div id="millerburnett-model-output" class="section level2">
<h2 class="hasAnchor">
<a href="#millerburnett-model-output" class="anchor"></a>Miller/Burnett Model Output</h2>
<p>The Miller/Burnett model uses a 10 meter resolution DEM to estimate debris flow delivery probabilities along stream channels in the Siuslaw basin. The two primary outputs of the model are a spatial points shapefile representing the channel as a linked node network, and a raster showing expected source intensities at the same resolution as the input DEM. This research does not make use of the raster of source intensities, rather the primary interest is in the delivery probabilities associated with nodes in the linked-node network representation of the channel.</p>
<p>The Miller/Burnett model uses the input DEM to predict the flow of water across the landscape and estimate stream channel position and extent. While water can flow from a pixel in any of eight directions depending on the slope and curvature of the pixel, the model defines channels as directional flow across a path of contiguous pixel corners. Each node in the stream network has a parent node tracing back to the point of initiation, and a child node leading to eventual output from the watershed.</p>
<p>Debris flows have a probability of occurring on each pixel of the landscape, and the model then estimates the aggregate probability of each debris flow reaching the channel, traversing along the channel and depositing in-stream. The delivery probability of a node represents the cumulative probability of receiving debris flow delivery from all sources in the landscape. Given that the input DEM was 10m in resolution, a channel node where neighboring nodes are connected along pixel edges represents the 10m of channel nearest to the node position, 5m up- and downstream. If the channel path crosses a pixel from corner to corner (not across an edge), then the segment length is closer to 14 meters. Depending upon the combination of neighboring connection lengths, nodes represent channel lengths varying in size from 10-14m, 5-7m up- and downstream of the node position.</p>
<p>The <code>muddier</code> package contains functions and data associated with this research project. The data object <code>knowles</code> is the subset of nodes for Knowles Creek.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(muddier)
<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(sp)

<span class="co"># the linked-node network for knowles creek is 'knowles'</span>
<span class="kw"><a href="https://www.rdocumentation.org/packages/graphics/topics/plot">plot</a></span>(knowles, <span class="dt">pch =</span> <span class="dv">20</span>, <span class="dt">col =</span> <span class="st">'slateblue'</span>, <span class="dt">xlab =</span> <span class="st">'knowles creek'</span>)</code></pre></div>
<p><img src="summer2019_update_files/figure-html/unnamed-chunk-1-1.png" width="700"></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">
<span class="co"># nodes consist of contiguous pixel corners</span>
<span class="kw"><a href="https://www.rdocumentation.org/packages/graphics/topics/plot">plot</a></span>(knowles[<span class="dv">250</span><span class="op">:</span><span class="dv">265</span>,], <span class="dt">pch =</span> <span class="dv">20</span>, <span class="dt">col =</span> <span class="st">'slateblue'</span>, <span class="dt">xlab =</span> <span class="st">'zoomed in on nodes'</span>)</code></pre></div>
<p><img src="summer2019_update_files/figure-html/unnamed-chunk-1-2.png" width="700"></p>
</div>
<div id="georeferencing-knowles-creek" class="section level2">
<h2 class="hasAnchor">
<a href="#georeferencing-knowles-creek" class="anchor"></a>Georeferencing Knowles Creek</h2>
<p>When field researchers record a GPS position of a tributary junction in the Lancaster survey data, the corresponding node on the linked-node network may diverge significantly in location. First, the model conforms channel position to corner points along a raster matching the input DEM in resolution. Second, the model applies a smoothing algorithm to avoid jagged or sawtoothed interpretations of smooth channnels traveling at acute angles to the raster pixel edges. The additive results of both processes can result in significant spatial divergence in position from the GPS position of a given landmark.</p>
<p>The distance between landmarks along the linked-node network can vary from the hipchain distances recorded in the Lancaster survey data due to the same two processes, namely coercion to a 10m raster and channel smoothing. Hipchain distances relative to node network distances may either be stretched or shrunken.</p>
<p>During a 2006 survey, Lancaster recorded the GPS coordinates of a number of tributary junctions along Knowles and assigned them id numbers. Although the majority of the tributary junctions recorded are downstream of the portion of the channel later surveyed by transect, the transect surveyors noted the presence of four tributary junctions recorded by Lancaster in 2006, which I was also able to locate by valley topography in LiDAR imagery and find a clear analogue in the linked-node network representation.</p>
<p>Transect survey field notes also referenced three tributary junctions further upstream, naming two of the tributaries as Heron and Boomer creeks, and noted the third to be intersecting the right bank of Knowles at hipchain 1448. The tributary junctions were identifiable by valley topography evident in LiDAR imagery of the area, and had clear analogues in the linked-node network. Lancaster also recorded GPS positions at hipchains 793 and 2907 in 2006.</p>
<p>The node shapefile from the Miller/Burnett output includes a variable called <code>ToMouth_km</code> which represents the distance to the channel outlet in kilometers for a given channel node. The difference in <code>ToMouth_km</code> values between nodes, whether it is greater or smaller than the hipchain distance recorded in the field survey between the same landmarks, determines the degree to which the hipchain distances have expanded or shrunken by coercion to the linked-node network.</p>
<p>If the hipchain distance between landmarks from the transect survey is <span class="math inline">\(L_{hip}\)</span>, and the outlet distance between landmarks in the MB model is <span class="math inline">\(L_{out}\)</span>, then the outlet to hipchain ratio is <span class="math inline">\(\frac{L_{out}}{L_{hip}}\)</span> so that multiplying a hipchain distance by the ratio produces a corresponding outlet distance. For each transect, I convert the hipchain distance to an outlet distance, then find the nearest corresponding node on the MB channel representation, and assign the transect to that node. For nodes in between transects, I can infer cross-sectional area and valley width by linear interpolation because the field researchers selected transect points that captured inflections in the valley contour.</p>
<p>The <code>muddier</code> package includes the resulting data object called <code>landmarks</code>. The <code>x</code> and <code>y</code> variables record the spatial position of the landmark node, <code>hip</code> records the hipchain distance upstream of the tributary junction for K-38, corrected for elevation, <code>nodeid</code> records the id of the corresponding node in the linked-node network for the landmark, <code>kmtout</code> is renamed from <code>ToMouth_km</code> and stands for ‘kilometers to outlet’, and <code>outhip</code> is the ratio of the difference in outlet distance and hipchain distance between the current and preceding node in the table. For the most upstream portion of the transect survey, lacking a landmark upstream of the survey site, I make the compromise of assuming the outlet to hipchain ratio is identical to the ratio for the nearest known segment of the survey area. Generally, hipchain distances are longer than outlet distances, both because the field researcher may cross banks in the process of securing the hipchain, elongating the distance traveled by taking a more sinuous travel path, and because the node-network representation is algorithmically smoothed, which shortens the path distance by reducing jaggedness in the path.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">landmarks
<span class="co">#&gt;           x       y     trib  hip nodeid   kmtout    outhip       id</span>
<span class="co">#&gt; 15 441182.7 4869117       32 -724 383982 17.93588 0.0000000     m724</span>
<span class="co">#&gt; 16 441408.5 4868968       33 -426 384004 18.19575 0.8720470     m426</span>
<span class="co">#&gt; 19 441457.0 4868909       36 -340 384009 18.24636 0.5884884     m340</span>
<span class="co">#&gt; 21 441480.4 4868618       38    0 384041 18.59045 1.0120294     ok38</span>
<span class="co">#&gt; 5  441374.0 4867942   ref793  793 384108 19.30378 0.8995334   ref793</span>
<span class="co">#&gt; 6  441164.0 4867592    heron 1239 384144 19.72113 0.9357623    heron</span>
<span class="co">#&gt; 7  441184.0 4867412 trib1448 1448 384162 19.90785 0.8933971 trib1448</span>
<span class="co">#&gt; 8  441154.0 4867132   boomer 1759 384190 20.19273 0.9160129   boomer</span>
<span class="co">#&gt; 9  440844.0 4866242  ref2907 2907 384291 21.28970 0.9555488  ref2907</span>
<span class="co">#&gt; 10 440274.0 4865702     init 4000 384364 22.12498 0.9555488     init</span></code></pre></div>
<p>Survey data at transects include valley sediment wedge area and contributing area. For nodes lying between transects, I estimate sediment wedge area and contributing area by linear interpolation. The Lancaster survey covers a channel segment consisting of 327 nodes, which I have saved into the <code>muddier</code> package as the object <code>transects</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="https://www.rdocumentation.org/packages/graphics/topics/plot">plot</a></span>(knowles, <span class="dt">pch =</span> <span class="dv">20</span>, <span class="dt">col =</span> <span class="st">'slateblue'</span>)
<span class="kw"><a href="https://www.rdocumentation.org/packages/graphics/topics/points">points</a></span>(transects, <span class="dt">pch =</span> <span class="dv">20</span>, <span class="dt">col =</span> <span class="st">'forestgreen'</span>)
<span class="kw"><a href="https://www.rdocumentation.org/packages/graphics/topics/points">points</a></span>(landmarks[ , <span class="dv">1</span><span class="op">:</span><span class="dv">2</span>], <span class="dt">pch =</span> <span class="dv">20</span>, <span class="dt">col =</span> <span class="st">'coral3'</span>)
<span class="kw"><a href="https://www.rdocumentation.org/packages/graphics/topics/legend">legend</a></span>(<span class="st">'bottomleft'</span>, <span class="dt">legend =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">'knowles creek'</span>, <span class="st">'transects'</span>, <span class="st">'landmarks'</span>),
       <span class="dt">fill =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">'slateblue'</span>, <span class="st">'forestgreen'</span>, <span class="st">'coral3'</span>))</code></pre></div>
<p><img src="summer2019_update_files/figure-html/unnamed-chunk-3-1.png" width="700"></p>
</div>
<div id="georeferencing-bear-creek" class="section level2">
<h2 class="hasAnchor">
<a href="#georeferencing-bear-creek" class="anchor"></a>Georeferencing Bear Creek</h2>
<p>In a similar manner to Knowles Creek, we can conform the transect survey to the node representation by relating hipchain lengths in the survey to outlet distances in the node network at tributary junctions. The Miller/Burnet node network representation of Bear Creek has 15 tributary junctions, all of which are clearly identifiable in the field notes of the Lancaster transect surveys. The data object <code>bear</code> in the <code>muddier</code> package is the node representation of Bear Creek with fitted Lancaster survey values for cross-sectional area, contributing area, and valley width.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">
trib_ids &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="dv">386219</span>, <span class="dv">386239</span>, <span class="dv">386243</span>, <span class="dv">386258</span>, <span class="dv">386269</span>, <span class="dv">386278</span>, <span class="dv">386299</span>, <span class="dv">386314</span>,
              <span class="dv">386331</span>, <span class="dv">386348</span>, <span class="dv">386359</span>, <span class="dv">386378</span>, <span class="dv">386389</span>, <span class="dv">386409</span>, <span class="dv">386440</span>, <span class="dv">386452</span>)
bear_tribs &lt;-<span class="st"> </span>bear[bear<span class="op">$</span>NODE_ID <span class="op">%in%</span><span class="st"> </span>trib_ids, ]

<span class="kw"><a href="https://www.rdocumentation.org/packages/graphics/topics/plot">plot</a></span>(bear, <span class="dt">pch =</span> <span class="dv">20</span>, <span class="dt">col =</span> <span class="st">'slateblue'</span>)
<span class="kw"><a href="https://www.rdocumentation.org/packages/graphics/topics/points">points</a></span>(bear_tribs, <span class="dt">pch =</span> <span class="dv">20</span>, <span class="dt">col =</span> <span class="st">'coral3'</span>)
<span class="kw"><a href="https://www.rdocumentation.org/packages/graphics/topics/legend">legend</a></span>(<span class="st">'bottomleft'</span>, <span class="dt">legend =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">'bear creek'</span>, <span class="st">'trib junctions'</span>),
       <span class="dt">fill =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">'slateblue'</span>, <span class="st">'coral3'</span>))</code></pre></div>
<p><img src="summer2019_update_files/figure-html/unnamed-chunk-4-1.png" width="700"></p>
</div>
<div id="debris-flow-residence-times" class="section level2">
<h2 class="hasAnchor">
<a href="#debris-flow-residence-times" class="anchor"></a>Debris Flow Residence Times</h2>
<p>The Lancaster dataset includes 370 radiocarbon-dated charcoal samples from stream bank deposits in Knowles, Bear, Cedar and Golden Ridge creeks. The sample ages can characterize the residence times of debris flows and fluvial deposits in stream, as the deposit cannot be older than the youngest piece of charcoal in the deposit. The period of time a piece of charcoal spends before becoming entrained in a stream deposit is the inherited age, and the sample age of the charcoal is the sum of the residence time of the deposit and the inherited age of the charcoal.</p>
<p>The field researchers collected multiple samples at deposit sites for debris flows, fluvial fines and fluvial gravels to assess the distribution of inherited ages in entrained charcoal. The sample ages come back from the lab as age distribution curves discretized to 5-year intervals, where values show the probability that the sample age falls within a given 5-year range, comprising a PMF. At each site with multiple samples, I subtracted the PMF of the youngest sample from the PMF of each sample at that site via convolution, including the youngest sample itself. Then I summed together the convolved PMFs by facies and renormalized to produce an inherited age distribution for each facies. I characterized the uncertainty around each inherited age distribution by bootstrapping.</p>
<p>The <code>muddier</code> vignette describes the functions and data objects used to estimate inherited age distributions and residence times, which is available at <a href="https://crumplecup.github.io/muddier/articles/muddier.html" class="uri">https://crumplecup.github.io/muddier/articles/muddier.html</a>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># plot inherited age CDF for debris flows</span>
<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(magrittr)
index &lt;-<span class="st"> </span>char_pmfs <span class="op">%&gt;%</span><span class="st"> </span>rownames <span class="op">%&gt;%</span><span class="st"> </span>as.numeric <span class="op">%&gt;%</span><span class="st"> </span>sort
<span class="kw"><a href="https://www.rdocumentation.org/packages/graphics/topics/plot">plot</a></span>(index, df_cdf, <span class="dt">lwd =</span> <span class="dv">2</span>, <span class="dt">type =</span> <span class="st">'l'</span>, <span class="dt">xlim =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="dv">0</span>, <span class="dv">11000</span>),
     <span class="dt">xlab =</span> <span class="st">'inherited age (debris flows)'</span>,
     <span class="dt">ylab =</span> <span class="st">'proportion &lt;= age'</span>)  <span class="co"># empiric cdf</span>
<span class="kw"><a href="https://www.rdocumentation.org/packages/graphics/topics/lines">lines</a></span>(index, df_cdfs_cis[<span class="dv">1</span>,], <span class="dt">lty =</span> <span class="dv">2</span>, <span class="dt">col =</span> <span class="st">'coral3'</span>, <span class="dt">lwd =</span> <span class="dv">2</span>)  <span class="co"># lower 97.5% CI</span>
<span class="kw"><a href="https://www.rdocumentation.org/packages/graphics/topics/lines">lines</a></span>(index, df_cdfs_cis[<span class="dv">3</span>,], <span class="dt">lty =</span> <span class="dv">2</span>, <span class="dt">col =</span> <span class="st">'coral3'</span>, <span class="dt">lwd =</span> <span class="dv">2</span>)  <span class="co"># upper 97.5% CI</span>
<span class="kw"><a href="https://www.rdocumentation.org/packages/graphics/topics/lines">lines</a></span>(index, <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/unlist">unlist</a></span>(df_ph_cdf), <span class="dt">lty =</span> <span class="dv">2</span>, <span class="dt">col =</span> <span class="st">'slateblue'</span>, <span class="dt">lwd =</span> <span class="dv">2</span>)  <span class="co"># phase-type fit</span>
<span class="kw"><a href="https://www.rdocumentation.org/packages/graphics/topics/legend">legend</a></span>(<span class="st">'bottomright'</span>, <span class="dt">legend =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">'empiric'</span>, <span class="st">'95% CIs'</span>, <span class="st">'phase-type fit'</span>),
       <span class="dt">fill =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">'black'</span>, <span class="st">'coral3'</span>, <span class="st">'slateblue'</span>))</code></pre></div>
<p><img src="summer2019_update_files/figure-html/unnamed-chunk-5-1.png" width="700"></p>
<p>I used the KPC Toolbox in Matlab to fit the empirical distribution of inherited age to a number of continuous distributions, namely the exponential, gamma, Weibull and phase-type distributions. We used the Kuiper statistic and Kolomogorov-Smirnov test to compare the goodness of fit. Prony’s method provided the distrubtion with the best goodness of fit statistic for debris flows, while the Weibull distribution provided the best fit for fluvial fines and fluvial gravels.</p>
<p>Using the fit distributions for inherited age for each facies, I then estimate the residence time of deposits with only one site sample by subtracting the inherited age distribution from the sample age PMF using convolution. In the <code>charcoal</code> dataset, where samples are arranged from youngest to oldest mean estimed sample age, we can compare the difference between esimated mean sample age and estimated mean residence time to illustrate the general size of the inherited age correction.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># expected mean residence time of corrected pmfs</span>
cor_mns &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/vector">vector</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/nrow">ncol</a></span>(cor_pmfs), <span class="dt">mode =</span> <span class="st">'numeric'</span>)
<span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/nrow">ncol</a></span>(cor_pmfs))  {
  cor_mns[i] &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/weighted.mean">weighted.mean</a></span>(index, cor_pmfs[,i])
}

<span class="co"># difference in uncorrected and corrected mean residence times</span>
mn_difs &lt;-<span class="st"> </span>charcoal<span class="op">$</span>mn <span class="op">-</span><span class="st"> </span>cor_mns

<span class="co"># plot residence time differences colored by facies</span>
df_difs &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/vector">vector</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/length">length</a></span>(mn_difs), <span class="dt">mode =</span> <span class="st">'numeric'</span>)
ff_difs &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/vector">vector</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/length">length</a></span>(mn_difs), <span class="dt">mode =</span> <span class="st">'numeric'</span>)
fg_difs &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/vector">vector</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/length">length</a></span>(mn_difs), <span class="dt">mode =</span> <span class="st">'numeric'</span>)

df_mns &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/vector">vector</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/length">length</a></span>(mn_difs), <span class="dt">mode =</span> <span class="st">'numeric'</span>)
ff_mns &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/vector">vector</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/length">length</a></span>(mn_difs), <span class="dt">mode =</span> <span class="st">'numeric'</span>)
fg_mns &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/vector">vector</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/length">length</a></span>(mn_difs), <span class="dt">mode =</span> <span class="st">'numeric'</span>)

df_difs[charcoal<span class="op">$</span>facies <span class="op">==</span><span class="st"> 'DF'</span>] &lt;-<span class="st"> </span>mn_difs[charcoal<span class="op">$</span>facies <span class="op">==</span><span class="st"> 'DF'</span>]
df_difs[charcoal<span class="op">$</span>facies <span class="op">!=</span><span class="st"> 'DF'</span>] &lt;-<span class="st"> </span><span class="ot">NA</span>
df_mns[charcoal<span class="op">$</span>facies <span class="op">==</span><span class="st"> 'DF'</span>] &lt;-<span class="st"> </span>charcoal<span class="op">$</span>mn[charcoal<span class="op">$</span>facies <span class="op">==</span><span class="st"> 'DF'</span>]
df_mns[charcoal<span class="op">$</span>facies <span class="op">!=</span><span class="st"> 'DF'</span>] &lt;-<span class="st"> </span><span class="ot">NA</span>

ff_difs[charcoal<span class="op">$</span>facies <span class="op">==</span><span class="st"> 'FF'</span>] &lt;-<span class="st"> </span>mn_difs[charcoal<span class="op">$</span>facies <span class="op">==</span><span class="st"> 'FF'</span>]
ff_difs[charcoal<span class="op">$</span>facies <span class="op">!=</span><span class="st"> 'FF'</span>] &lt;-<span class="st"> </span><span class="ot">NA</span>
ff_mns[charcoal<span class="op">$</span>facies <span class="op">==</span><span class="st"> 'FF'</span>] &lt;-<span class="st"> </span>charcoal<span class="op">$</span>mn[charcoal<span class="op">$</span>facies <span class="op">==</span><span class="st"> 'FF'</span>]
ff_mns[charcoal<span class="op">$</span>facies <span class="op">!=</span><span class="st"> 'FF'</span>] &lt;-<span class="st"> </span><span class="ot">NA</span>

fg_difs[charcoal<span class="op">$</span>facies <span class="op">==</span><span class="st"> 'FG'</span>] &lt;-<span class="st"> </span>mn_difs[charcoal<span class="op">$</span>facies <span class="op">==</span><span class="st"> 'FG'</span>]
fg_difs[charcoal<span class="op">$</span>facies <span class="op">!=</span><span class="st"> 'FG'</span>] &lt;-<span class="st"> </span><span class="ot">NA</span>
fg_mns[charcoal<span class="op">$</span>facies <span class="op">==</span><span class="st"> 'FG'</span>] &lt;-<span class="st"> </span>charcoal<span class="op">$</span>mn[charcoal<span class="op">$</span>facies <span class="op">==</span><span class="st"> 'FG'</span>]
fg_mns[charcoal<span class="op">$</span>facies <span class="op">!=</span><span class="st"> 'FG'</span>] &lt;-<span class="st"> </span><span class="ot">NA</span>


<span class="kw"><a href="https://www.rdocumentation.org/packages/graphics/topics/plot">plot</a></span>(fg_mns, fg_difs, <span class="dt">pch =</span> <span class="dv">20</span>, <span class="dt">col =</span> <span class="st">'coral3'</span>,
     <span class="dt">xlab =</span> <span class="st">'mean sample age'</span>, <span class="dt">ylab =</span> <span class="st">'mean inherited age'</span>)
<span class="kw"><a href="https://www.rdocumentation.org/packages/graphics/topics/points">points</a></span>(ff_mns, ff_difs, <span class="dt">pch =</span> <span class="dv">20</span>, <span class="dt">col =</span> <span class="st">'slateblue'</span>)
<span class="kw"><a href="https://www.rdocumentation.org/packages/graphics/topics/points">points</a></span>(df_mns, df_difs, <span class="dt">pch =</span> <span class="dv">20</span>, <span class="dt">col =</span> <span class="st">'forestgreen'</span>)
<span class="kw"><a href="https://www.rdocumentation.org/packages/graphics/topics/legend">legend</a></span>(<span class="st">'bottomright'</span>, <span class="dt">legend =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">'debris flows'</span>, <span class="st">'fluvial fines'</span>, <span class="st">'fluvial gravels'</span>),
       <span class="dt">fill =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">'forestgreen'</span>, <span class="st">'slateblue'</span>, <span class="st">'coral3'</span>))</code></pre></div>
<p><img src="summer2019_update_files/figure-html/unnamed-chunk-6-1.png" width="700"></p>
<p>In the same manner as for inherited age, I used the KPC Toolbox in Matlab to fit the empirical distribution of residence times for each facies to a number of continuous distributions, using the Kuiper statistic and K-S test to determine goodness of fit.</p>
</div>
<div id="examining-delivery-probabilities" class="section level2">
<h2 class="hasAnchor">
<a href="#examining-delivery-probabilities" class="anchor"></a>Examining Delivery Probabilities</h2>
<p>During the transect survey, the field researchers selected transect positions that captured inflections in the valley contour. By recording the depth of sediment across the transect, the researcher can estimate the volume of sediment in a valley area by linear interpolation due to careful selection of transect position to represent the valley contour.</p>
<p>In a similar manner to how Miller &amp; Burnett used landslide runout track surveys to calibrate a topological index to an empiric record of debris flows, we can use the transect record of valley sediment deposition to calibrate predicted delivery probabilities in the Miller/Burnett model.</p>
<div id="weighting-by-area-slope-relation" class="section level3">
<h3 class="hasAnchor">
<a href="#weighting-by-area-slope-relation" class="anchor"></a>Weighting by Area-Slope Relation</h3>
<p>We can fit the area-slope relation to a power law where slope <span class="math inline">\(S\)</span> relates to contributing area <span class="math inline">\(A\)</span> by the function:</p>
<p><span class="math display">\[ S = k_sA^{-\theta}  \]</span></p>
<p>We can relate logged slope to logged contributing area using a linear model, so that:</p>
<p><span class="math display">\[  log(S) = log(k_sA^{-\theta})  \]</span> <span class="math display">\[  log(S) = log(k_s) - \theta log(A)  \]</span></p>
<p>where <span class="math inline">\(\theta\)</span> is the slope of a linear model with intercept <span class="math inline">\(log(k_s)\)</span>. Using the estimated <span class="math inline">\(\theta\)</span> for all surveyed creeks, we can back-calculate an individual <span class="math inline">\(k_s\)</span> for each channel node holding <span class="math inline">\(\theta\)</span> constant.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">

<span class="co"># find ks values in S = ks(A^theta)</span>
lslope_kn &lt;-<span class="st"> </span>transects<span class="op">$</span>GRADIENT <span class="op">%&gt;%</span><span class="st"> </span>log  <span class="co"># logged slope</span>
lcontr_kn &lt;-<span class="st"> </span>transects<span class="op">$</span>contr <span class="op">%&gt;%</span><span class="st"> </span>log <span class="co"># logged contr area</span>
lslope_br &lt;-<span class="st"> </span>bear<span class="op">$</span>GRADIENT <span class="op">%&gt;%</span><span class="st"> </span>log  <span class="co"># logged slope</span>
lcontr_br &lt;-<span class="st"> </span>(bear<span class="op">$</span>contr_area<span class="op">/</span><span class="dv">1000000</span>) <span class="op">%&gt;%</span><span class="st"> </span>log <span class="co"># logged contr area</span>

lslope &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(lslope_kn, lslope_br)
lcontr &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(lcontr_kn, lcontr_br)
as_mod &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/lm">lm</a></span>(lslope <span class="op">~</span><span class="st"> </span>lcontr)  <span class="co"># fit AS to power law</span>
as_theta &lt;-<span class="st"> </span>as_mod<span class="op">$</span>coefficients[<span class="dv">2</span>]  <span class="co"># pull theta value</span>
sum_mod &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/summary">summary</a></span>(as_mod)

<span class="kw"><a href="https://www.rdocumentation.org/packages/graphics/topics/plot">plot</a></span>(lcontr_kn, lslope_kn, <span class="dt">pch =</span> <span class="dv">20</span>, <span class="dt">col =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/grDevices/topics/rgb">rgb</a></span>(<span class="dt">red=</span><span class="dv">1</span>, <span class="dt">green=</span><span class="dv">0</span>, <span class="dt">blue=</span>.<span class="dv">2</span>, <span class="dt">alpha=</span>.<span class="dv">5</span>),
     <span class="dt">xlab =</span> <span class="st">'log(contributing area)'</span>, <span class="dt">ylab =</span> <span class="st">'log(slope)'</span>)
<span class="kw"><a href="https://www.rdocumentation.org/packages/graphics/topics/points">points</a></span>(lcontr_br, lslope_br, <span class="dt">pch =</span> <span class="dv">20</span>, <span class="dt">col =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/grDevices/topics/rgb">rgb</a></span>(<span class="dt">red=</span>.<span class="dv">5</span>, <span class="dt">green=</span><span class="dv">0</span>, <span class="dt">blue=</span>.<span class="dv">7</span>, <span class="dt">alpha=</span>.<span class="dv">5</span>))
<span class="kw"><a href="https://www.rdocumentation.org/packages/graphics/topics/abline">abline</a></span>(as_mod, <span class="dt">lwd =</span> <span class="dv">2</span>, <span class="dt">col =</span> <span class="st">'goldenrod'</span>)
<span class="kw"><a href="https://www.rdocumentation.org/packages/sp/topics/gridlines">text</a></span>(<span class="dv">1</span>,<span class="op">-</span><span class="dv">2</span>, <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/paste">paste0</a></span>(<span class="st">'R2 = '</span>, <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/Round">round</a></span>(sum_mod<span class="op">$</span>adj.r.squared, <span class="dv">3</span>)))
<span class="kw"><a href="https://www.rdocumentation.org/packages/graphics/topics/legend">legend</a></span>(<span class="st">'topright'</span>, <span class="dt">legend =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">'knowles'</span>, <span class="st">'bear'</span>), <span class="dt">fill =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">'coral3'</span>, <span class="st">'purple'</span>))

<span class="co"># estimate individual ks values using pulled theta</span>
log_ks_kn &lt;-<span class="st"> </span>lslope_kn <span class="op">-</span><span class="st"> </span>as_theta <span class="op">*</span><span class="st"> </span>lcontr_kn
ks_kn &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/Log">exp</a></span>(log_ks_kn)
transects<span class="op">$</span>p_ks &lt;-<span class="st"> </span>transects<span class="op">$</span>dfprob <span class="op">/</span><span class="st"> </span>ks_kn

log_ks_br &lt;-<span class="st"> </span>lslope_br <span class="op">-</span><span class="st"> </span>as_theta <span class="op">*</span><span class="st"> </span>lcontr_br
ks_br &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/Log">exp</a></span>(log_ks_br)
bear<span class="op">$</span>p_ks &lt;-<span class="st"> </span>bear<span class="op">$</span>DebrisFlow <span class="op">/</span><span class="st"> </span>ks_br


<span class="kw"><a href="https://www.rdocumentation.org/packages/graphics/topics/plot">plot</a></span>(transects<span class="op">$</span>contr, transects<span class="op">$</span>DebrisFlow,
     <span class="dt">col =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/grDevices/topics/rgb">rgb</a></span>(<span class="dt">red=</span>.<span class="dv">5</span>, <span class="dt">green=</span><span class="dv">1</span>, <span class="dt">blue=</span>.<span class="dv">7</span>, <span class="dt">alpha=</span>.<span class="dv">5</span>), <span class="dt">pch=</span><span class="dv">20</span>,
     <span class="dt">xlab=</span><span class="st">'Contributing Area (km2)'</span>, <span class="dt">ylab=</span><span class="st">'Delivery Probability'</span>)
<span class="kw"><a href="https://www.rdocumentation.org/packages/graphics/topics/points">points</a></span>(bear<span class="op">$</span>contr_area<span class="op">/</span><span class="dv">1000000</span>, bear<span class="op">$</span>DebrisFlow,
       <span class="dt">col =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/grDevices/topics/rgb">rgb</a></span>(<span class="dt">red=</span>.<span class="dv">5</span>, <span class="dt">green=</span><span class="dv">0</span>, <span class="dt">blue=</span>.<span class="dv">7</span>, <span class="dt">alpha=</span>.<span class="dv">5</span>), <span class="dt">pch=</span><span class="dv">20</span>)
<span class="kw"><a href="https://www.rdocumentation.org/packages/graphics/topics/legend">legend</a></span>(<span class="st">'topright'</span>, <span class="dt">legend =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">'knowles'</span>, <span class="st">'bear'</span>), <span class="dt">fill =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">'forestgreen'</span>, <span class="st">'purple'</span>))</code></pre></div>
<p><img src="summer2019_update_files/figure-html/unnamed-chunk-7-1.png" width="700"><img src="summer2019_update_files/figure-html/unnamed-chunk-7-2.png" width="700"></p>
<p>Comparison of cross-sectional area at transects to Miller/Burnett delivery probabilities shows better correlation for Bear Creek than for Knowles Creek. The correlation is also stronger for Bear Creek examining the relation between delivery probabilities and valley width. In addition to examining delivery probabilities <span class="math inline">\(P\)</span>, we also examine the ratio of <span class="math inline">\(P/k_s\)</span> in relation to the same channel characteristics.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="https://www.rdocumentation.org/packages/graphics/topics/plot">plot</a></span>(transects<span class="op">$</span>DebrisFlow, transects<span class="op">$</span>area,
     <span class="dt">col =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/grDevices/topics/rgb">rgb</a></span>(<span class="dt">red=</span><span class="dv">1</span>, <span class="dt">green=</span><span class="dv">0</span>, <span class="dt">blue=</span>.<span class="dv">2</span>, <span class="dt">alpha=</span>.<span class="dv">5</span>), <span class="dt">pch=</span><span class="dv">20</span>,
     <span class="dt">ylab=</span><span class="st">'Cross-sectional Area (m2)'</span>, <span class="dt">xlab=</span><span class="st">'Delivery Probability'</span> )
<span class="kw"><a href="https://www.rdocumentation.org/packages/graphics/topics/points">points</a></span>(bear<span class="op">$</span>DebrisFlow, bear<span class="op">$</span>xsec_area,
       <span class="dt">col =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/grDevices/topics/rgb">rgb</a></span>(<span class="dt">red=</span>.<span class="dv">5</span>, <span class="dt">green=</span><span class="dv">0</span>, <span class="dt">blue=</span>.<span class="dv">7</span>, <span class="dt">alpha=</span>.<span class="dv">5</span>), <span class="dt">pch=</span><span class="dv">20</span>)
<span class="kw"><a href="https://www.rdocumentation.org/packages/graphics/topics/abline">abline</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/lm">lm</a></span>(transects<span class="op">$</span>area <span class="op">~</span><span class="st"> </span>transects<span class="op">$</span>DebrisFlow),<span class="dt">col=</span><span class="st">'coral3'</span>)
<span class="kw"><a href="https://www.rdocumentation.org/packages/graphics/topics/abline">abline</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/lm">lm</a></span>(bear<span class="op">$</span>xsec_area <span class="op">~</span><span class="st"> </span>bear<span class="op">$</span>DebrisFlow),<span class="dt">col=</span><span class="st">'purple'</span>)
<span class="kw"><a href="https://www.rdocumentation.org/packages/graphics/topics/legend">legend</a></span>(<span class="st">'topright'</span>, <span class="dt">legend =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">'knowles'</span>, <span class="st">'bear'</span>), <span class="dt">fill =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">'coral3'</span>, <span class="st">'purple'</span>))

<span class="kw"><a href="https://www.rdocumentation.org/packages/graphics/topics/plot">plot</a></span>(transects<span class="op">$</span>p_ks, transects<span class="op">$</span>area,
     <span class="dt">col =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/grDevices/topics/rgb">rgb</a></span>(<span class="dt">red=</span><span class="dv">1</span>, <span class="dt">green=</span><span class="dv">0</span>, <span class="dt">blue=</span>.<span class="dv">2</span>, <span class="dt">alpha=</span>.<span class="dv">5</span>), <span class="dt">pch=</span><span class="dv">20</span>,
     <span class="dt">ylab=</span><span class="st">'Cross-sectional Area (m2)'</span>, <span class="dt">xlab=</span><span class="st">'P/ks'</span> )
<span class="kw"><a href="https://www.rdocumentation.org/packages/graphics/topics/points">points</a></span>(bear<span class="op">$</span>p_ks, bear<span class="op">$</span>xsec_area,
       <span class="dt">col =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/grDevices/topics/rgb">rgb</a></span>(<span class="dt">red=</span>.<span class="dv">5</span>, <span class="dt">green=</span><span class="dv">0</span>, <span class="dt">blue=</span>.<span class="dv">7</span>, <span class="dt">alpha=</span>.<span class="dv">5</span>), <span class="dt">pch=</span><span class="dv">20</span>)
<span class="kw"><a href="https://www.rdocumentation.org/packages/graphics/topics/abline">abline</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/lm">lm</a></span>(transects<span class="op">$</span>area <span class="op">~</span><span class="st"> </span>transects<span class="op">$</span>p_ks),<span class="dt">col=</span><span class="st">'coral3'</span>)
<span class="kw"><a href="https://www.rdocumentation.org/packages/graphics/topics/abline">abline</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/lm">lm</a></span>(bear<span class="op">$</span>xsec_area <span class="op">~</span><span class="st"> </span>bear<span class="op">$</span>p_ks),<span class="dt">col=</span><span class="st">'purple'</span>)
<span class="kw"><a href="https://www.rdocumentation.org/packages/graphics/topics/legend">legend</a></span>(<span class="st">'topright'</span>, <span class="dt">legend =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">'knowles'</span>, <span class="st">'bear'</span>), <span class="dt">fill =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">'coral3'</span>, <span class="st">'purple'</span>))



<span class="kw"><a href="https://www.rdocumentation.org/packages/graphics/topics/plot">plot</a></span>(transects<span class="op">$</span>DebrisFlow, transects<span class="op">$</span>top,
     <span class="dt">col =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/grDevices/topics/rgb">rgb</a></span>(<span class="dt">red=</span><span class="dv">1</span>, <span class="dt">green=</span><span class="dv">0</span>, <span class="dt">blue=</span>.<span class="dv">2</span>, <span class="dt">alpha=</span>.<span class="dv">5</span>), <span class="dt">pch=</span><span class="dv">20</span>,
     <span class="dt">ylab=</span><span class="st">'Valley Width (m)'</span>,<span class="dt">xlab=</span><span class="st">'Delivery Probability'</span> )
<span class="kw"><a href="https://www.rdocumentation.org/packages/graphics/topics/points">points</a></span>(bear<span class="op">$</span>DebrisFlow, bear<span class="op">$</span>valley_width,
       <span class="dt">col =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/grDevices/topics/rgb">rgb</a></span>(<span class="dt">red=</span>.<span class="dv">5</span>, <span class="dt">green=</span><span class="dv">0</span>, <span class="dt">blue=</span>.<span class="dv">7</span>, <span class="dt">alpha=</span>.<span class="dv">5</span>), <span class="dt">pch=</span><span class="dv">20</span>)
<span class="kw"><a href="https://www.rdocumentation.org/packages/graphics/topics/abline">abline</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/lm">lm</a></span>(transects<span class="op">$</span>top <span class="op">~</span><span class="st"> </span>transects<span class="op">$</span>DebrisFlow),<span class="dt">col=</span><span class="st">'coral3'</span>)
<span class="kw"><a href="https://www.rdocumentation.org/packages/graphics/topics/abline">abline</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/lm">lm</a></span>(bear<span class="op">$</span>valley_width <span class="op">~</span><span class="st"> </span>bear<span class="op">$</span>DebrisFlow),<span class="dt">col=</span><span class="st">'purple'</span>)
<span class="kw"><a href="https://www.rdocumentation.org/packages/graphics/topics/legend">legend</a></span>(<span class="st">'topright'</span>, <span class="dt">legend =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">'knowles'</span>, <span class="st">'bear'</span>), <span class="dt">fill =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">'coral3'</span>, <span class="st">'purple'</span>))

<span class="kw"><a href="https://www.rdocumentation.org/packages/graphics/topics/plot">plot</a></span>(transects<span class="op">$</span>p_ks, transects<span class="op">$</span>top,
     <span class="dt">col =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/grDevices/topics/rgb">rgb</a></span>(<span class="dt">red=</span><span class="dv">1</span>, <span class="dt">green=</span><span class="dv">0</span>, <span class="dt">blue=</span>.<span class="dv">2</span>, <span class="dt">alpha=</span>.<span class="dv">5</span>), <span class="dt">pch=</span><span class="dv">20</span>,
     <span class="dt">ylab=</span><span class="st">'Valley Width (m)'</span>,<span class="dt">xlab=</span><span class="st">'P/ks'</span> )
<span class="kw"><a href="https://www.rdocumentation.org/packages/graphics/topics/points">points</a></span>(bear<span class="op">$</span>p_ks, bear<span class="op">$</span>valley_width,
       <span class="dt">col =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/grDevices/topics/rgb">rgb</a></span>(<span class="dt">red=</span>.<span class="dv">5</span>, <span class="dt">green=</span><span class="dv">0</span>, <span class="dt">blue=</span>.<span class="dv">7</span>, <span class="dt">alpha=</span>.<span class="dv">5</span>), <span class="dt">pch=</span><span class="dv">20</span>)
<span class="kw"><a href="https://www.rdocumentation.org/packages/graphics/topics/abline">abline</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/lm">lm</a></span>(transects<span class="op">$</span>top <span class="op">~</span><span class="st"> </span>transects<span class="op">$</span>p_ks),<span class="dt">col=</span><span class="st">'coral3'</span>)
<span class="kw"><a href="https://www.rdocumentation.org/packages/graphics/topics/abline">abline</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/lm">lm</a></span>(bear<span class="op">$</span>valley_width <span class="op">~</span><span class="st"> </span>bear<span class="op">$</span>p_ks),<span class="dt">col=</span><span class="st">'purple'</span>)
<span class="kw"><a href="https://www.rdocumentation.org/packages/graphics/topics/legend">legend</a></span>(<span class="st">'topright'</span>, <span class="dt">legend =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">'knowles'</span>, <span class="st">'bear'</span>), <span class="dt">fill =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">'coral3'</span>, <span class="st">'purple'</span>))</code></pre></div>
<p><img src="summer2019_update_files/figure-html/unnamed-chunk-8-1.png" width="700"><img src="summer2019_update_files/figure-html/unnamed-chunk-8-2.png" width="700"><img src="summer2019_update_files/figure-html/unnamed-chunk-8-3.png" width="700"><img src="summer2019_update_files/figure-html/unnamed-chunk-8-4.png" width="700"></p>
</div>
</div>
<div id="weighting-delivery-probabilities" class="section level2">
<h2 class="hasAnchor">
<a href="#weighting-delivery-probabilities" class="anchor"></a>Weighting Delivery Probabilities</h2>
<p>Let <span class="math inline">\(P\)</span> represent delivery probabilities, and let <span class="math inline">\(F_P (P_0)\)</span> be the CDF of delivery probabilities. Let <span class="math inline">\(V\)</span> represent depositional volume, and let <span class="math inline">\(F_V (P_0)\)</span> be the CDF of volume with respect to <span class="math inline">\(P\)</span>. The volume weighting function <span class="math inline">\(wt_V\)</span> over an interval <span class="math inline">\(P_i\)</span> to <span class="math inline">\(P_{i + 1}\)</span> along <span class="math inline">\(P\)</span> is:</p>
<p><span class="math display">\[ wt_V (P_i, P_{i+1}) = \frac{F_V (P_{i+1}) - F_V (P_i)}{F_P (P_{i+1}) - F_P (P_i)} \]</span></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">
kn_sub &lt;-<span class="st"> </span>transects[,<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="dv">2</span><span class="op">:</span><span class="dv">4</span>,<span class="dv">7</span><span class="op">:</span><span class="dv">10</span>,<span class="dv">14</span>)]  <span class="co"># knowles subset</span>
kn_sub<span class="op">$</span>name &lt;-<span class="st"> 'knowles'</span>
br_sub &lt;-<span class="st"> </span>bear[,<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="dv">2</span><span class="op">:</span><span class="dv">4</span>,<span class="dv">7</span><span class="op">:</span><span class="dv">11</span>)]  <span class="co"># bear subset</span>
br_sub<span class="op">$</span>name &lt;-<span class="st"> 'bear'</span>
<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/names">names</a></span>(kn_sub) &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/names">names</a></span>(br_sub)
creeks &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/cbind">rbind</a></span>(kn_sub, br_sub)


<span class="co"># weighting function for delivery probs</span>

<span class="co"># delivery prob index</span>
p_index &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/sort">sort</a></span>(creeks<span class="op">$</span>DebrisFlow)

<span class="co"># cdf of delivery probs</span>
p_cdf &lt;-<span class="st"> </span><span class="kw"><a href="../reference/to_cdf.html">to_cdf</a></span>(p_index<span class="op">/</span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/sum">sum</a></span>(p_index))

<span class="co"># change in delivery prob cdf per change in index</span>
delta_p &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/vector">vector</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/length">length</a></span>(p_index), <span class="dt">mode =</span> <span class="st">'numeric'</span>)
<span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">2</span><span class="op">:</span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/length">length</a></span>(delta_p))  {
  delta_p[i] &lt;-<span class="st"> </span>p_cdf[i] <span class="op">-</span><span class="st"> </span>p_cdf[i<span class="op">-</span><span class="dv">1</span>]
}

<span class="co"># cdf of volume by prob index</span>
v_cdf &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/vector">vector</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/length">length</a></span>(p_index), <span class="dt">mode =</span> <span class="st">'numeric'</span>)
<span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">2</span><span class="op">:</span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/length">length</a></span>(v_cdf))  {
  v_cdf[i] &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/sum">sum</a></span>(creeks<span class="op">$</span>xsec_area[creeks<span class="op">$</span>DebrisFlow <span class="op">&lt;=</span><span class="st"> </span>p_index[i]]) <span class="op">/</span>
<span class="st">    </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/sum">sum</a></span>(creeks<span class="op">$</span>xsec_area)
}

<span class="co"># change in volume cdf per change in index</span>
delta_v &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/vector">vector</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/length">length</a></span>(p_index), <span class="dt">mode =</span> <span class="st">'numeric'</span>)
<span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">2</span><span class="op">:</span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/length">length</a></span>(delta_v))  {
  delta_v[i] &lt;-<span class="st"> </span>v_cdf[i] <span class="op">-</span><span class="st"> </span>v_cdf[i<span class="op">-</span><span class="dv">1</span>]
}

<span class="co"># change in volume cdf per change in del prob cdf</span>
p_wt &lt;-<span class="st"> </span>delta_v <span class="op">/</span><span class="st"> </span>delta_p


<span class="kw"><a href="https://www.rdocumentation.org/packages/graphics/topics/plot">plot</a></span>(creeks<span class="op">$</span>p_ks, p_wt, <span class="dt">pch =</span> <span class="dv">20</span>, <span class="dt">col =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/grDevices/topics/rgb">rgb</a></span>(<span class="dt">red=</span>.<span class="dv">5</span>, <span class="dt">green=</span><span class="dv">0</span>, <span class="dt">blue=</span>.<span class="dv">7</span>, <span class="dt">alpha=</span>.<span class="dv">01</span>),
     <span class="dt">xlab =</span> <span class="st">'delivery probability'</span>, <span class="dt">ylab =</span> <span class="st">'wt_V'</span>)
<span class="kw"><a href="https://www.rdocumentation.org/packages/graphics/topics/points">points</a></span>(creeks<span class="op">$</span>p_ks[creeks<span class="op">$</span>name <span class="op">==</span><span class="st"> 'knowles'</span>], 
       p_wt[creeks<span class="op">$</span>name <span class="op">==</span><span class="st"> 'knowles'</span>], <span class="dt">pch =</span> <span class="dv">20</span>,
       <span class="dt">col =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/grDevices/topics/rgb">rgb</a></span>(<span class="dt">red=</span><span class="dv">1</span>, <span class="dt">green=</span><span class="dv">0</span>, <span class="dt">blue=</span>.<span class="dv">2</span>, <span class="dt">alpha=</span>.<span class="dv">1</span>))
<span class="kw"><a href="https://www.rdocumentation.org/packages/graphics/topics/points">points</a></span>(creeks<span class="op">$</span>p_ks[creeks<span class="op">$</span>name <span class="op">==</span><span class="st"> 'bear'</span>], 
       p_wt[creeks<span class="op">$</span>name <span class="op">==</span><span class="st"> 'bear'</span>], <span class="dt">pch =</span> <span class="dv">20</span>,
       <span class="dt">col =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/grDevices/topics/rgb">rgb</a></span>(<span class="dt">red=</span>.<span class="dv">5</span>, <span class="dt">green=</span><span class="dv">0</span>, <span class="dt">blue=</span>.<span class="dv">7</span>, <span class="dt">alpha=</span>.<span class="dv">1</span>))
<span class="kw"><a href="https://www.rdocumentation.org/packages/graphics/topics/abline">abline</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/lm">lm</a></span>(p_wt <span class="op">~</span><span class="st"> </span>creeks<span class="op">$</span>p_ks), <span class="dt">col =</span> <span class="st">'gray'</span>)
<span class="kw"><a href="https://www.rdocumentation.org/packages/graphics/topics/legend">legend</a></span>(<span class="st">'topright'</span>, <span class="dt">legend =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">'knowles'</span>, <span class="st">'bear'</span>), <span class="dt">fill =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">'coral3'</span>, <span class="st">'purple'</span>))</code></pre></div>
<p><img src="summer2019_update_files/figure-html/unnamed-chunk-9-1.png" width="700"></p>
<p>Using <span class="math inline">\(K\)</span> for the ratio of <span class="math inline">\(P/k_s\)</span>, let <span class="math inline">\(F_V(K_0)\)</span> be the CDF of <span class="math inline">\(V\)</span> with respect to <span class="math inline">\(P/k_s\)</span>. We can then compare change in the CDF of <span class="math inline">\(V\)</span> to change in the CDF of <span class="math inline">\(K\)</span>. The volume weighting function <span class="math inline">\(wt_{V_K}\)</span> over an interval <span class="math inline">\(K_i\)</span> to <span class="math inline">\(K_{i + 1}\)</span> along <span class="math inline">\(K\)</span> is:</p>
<p><span class="math display">\[ wt_{V_K} (K_i, K_{i+1}) = \frac{F_V (K_{i+1}) - F_V (K_i)}{F_K (K_{i+1}) - F_K (K_i)} \]</span></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">
<span class="co"># P/ks index</span>
k_index &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/sort">sort</a></span>(creeks<span class="op">$</span>p_ks)

<span class="co"># cdf of F_K</span>
k_cdf &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/vector">vector</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/length">length</a></span>(k_index), <span class="dt">mode =</span> <span class="st">'numeric'</span>)
<span class="cf">for</span> (i <span class="cf">in</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/seq">seq_along</a></span>(k_cdf))  {
  k_cdf[i] &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/sum">sum</a></span>(creeks<span class="op">$</span>p_ks[creeks<span class="op">$</span>p_ks <span class="op">&lt;=</span><span class="st"> </span>k_index[i]]) <span class="op">/</span>
<span class="st">    </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/sum">sum</a></span>(creeks<span class="op">$</span>p_ks)
}

<span class="co"># change in p_ks cdf per change in index (F_K(P_0))</span>
delta_k &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/vector">vector</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/length">length</a></span>(k_index), <span class="dt">mode =</span> <span class="st">'numeric'</span>)
<span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">2</span><span class="op">:</span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/length">length</a></span>(delta_k))  {
  delta_k[i] &lt;-<span class="st"> </span>k_cdf[i] <span class="op">-</span><span class="st"> </span>k_cdf[i<span class="op">-</span><span class="dv">1</span>]
}

<span class="co"># cdf of F_V(K)</span>
vk_cdf &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/vector">vector</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/length">length</a></span>(k_index), <span class="dt">mode =</span> <span class="st">'numeric'</span>)
<span class="cf">for</span> (i <span class="cf">in</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/seq">seq_along</a></span>(k_cdf))  {
  vk_cdf[i] &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/sum">sum</a></span>(creeks<span class="op">$</span>xsec_area[creeks<span class="op">$</span>p_ks <span class="op">&lt;=</span><span class="st"> </span>k_index[i]]) <span class="op">/</span>
<span class="st">    </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/sum">sum</a></span>(creeks<span class="op">$</span>xsec_area)
}

<span class="co"># change in F_V(K_0)</span>
delta_vk &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/vector">vector</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/length">length</a></span>(k_index), <span class="dt">mode =</span> <span class="st">'numeric'</span>)
<span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">2</span><span class="op">:</span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/length">length</a></span>(delta_vk))  {
  delta_vk[i] &lt;-<span class="st"> </span>vk_cdf[i] <span class="op">-</span><span class="st"> </span>vk_cdf[i<span class="op">-</span><span class="dv">1</span>]
}


<span class="co"># change in volume cdf per change in del prob cdf</span>
vk_wt &lt;-<span class="st"> </span>delta_vk <span class="op">/</span><span class="st"> </span>delta_k

<span class="kw"><a href="https://www.rdocumentation.org/packages/graphics/topics/plot">plot</a></span>(creeks<span class="op">$</span>p_ks, vk_wt, <span class="dt">pch =</span> <span class="dv">20</span>, <span class="dt">col =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/grDevices/topics/rgb">rgb</a></span>(<span class="dt">red=</span>.<span class="dv">5</span>, <span class="dt">green=</span><span class="dv">0</span>, <span class="dt">blue=</span>.<span class="dv">7</span>, <span class="dt">alpha=</span>.<span class="dv">01</span>),
     <span class="dt">xlab =</span> <span class="st">'P/Ks'</span>, <span class="dt">ylab =</span> <span class="st">'wt_Vk'</span>)
<span class="kw"><a href="https://www.rdocumentation.org/packages/graphics/topics/points">points</a></span>(creeks<span class="op">$</span>p_ks[creeks<span class="op">$</span>name <span class="op">==</span><span class="st"> 'knowles'</span>], 
       vk_wt[creeks<span class="op">$</span>name <span class="op">==</span><span class="st"> 'knowles'</span>], <span class="dt">pch =</span> <span class="dv">20</span>,
       <span class="dt">col =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/grDevices/topics/rgb">rgb</a></span>(<span class="dt">red=</span><span class="dv">1</span>, <span class="dt">green=</span><span class="dv">0</span>, <span class="dt">blue=</span>.<span class="dv">2</span>, <span class="dt">alpha=</span>.<span class="dv">1</span>))
<span class="kw"><a href="https://www.rdocumentation.org/packages/graphics/topics/points">points</a></span>(creeks<span class="op">$</span>p_ks[creeks<span class="op">$</span>name <span class="op">==</span><span class="st"> 'bear'</span>], 
       vk_wt[creeks<span class="op">$</span>name <span class="op">==</span><span class="st"> 'bear'</span>], <span class="dt">pch =</span> <span class="dv">20</span>,
       <span class="dt">col =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/grDevices/topics/rgb">rgb</a></span>(<span class="dt">red=</span>.<span class="dv">5</span>, <span class="dt">green=</span><span class="dv">0</span>, <span class="dt">blue=</span>.<span class="dv">7</span>, <span class="dt">alpha=</span>.<span class="dv">1</span>))
<span class="kw"><a href="https://www.rdocumentation.org/packages/graphics/topics/abline">abline</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/lm">lm</a></span>(vk_wt <span class="op">~</span><span class="st"> </span>creeks<span class="op">$</span>p_ks), <span class="dt">col =</span> <span class="st">'gray'</span>)
<span class="kw"><a href="https://www.rdocumentation.org/packages/graphics/topics/legend">legend</a></span>(<span class="st">'topright'</span>, <span class="dt">legend =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">'knowles'</span>, <span class="st">'bear'</span>), <span class="dt">fill =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">'coral3'</span>, <span class="st">'purple'</span>))</code></pre></div>
<p><img src="summer2019_update_files/figure-html/unnamed-chunk-10-1.png" width="700"></p>
<p>We can follow the same procedure using top valley width, with distance <span class="math inline">\(D\)</span> representing valley width, let <span class="math inline">\(F_D (P_0)\)</span> be the CDF of <span class="math inline">\(D\)</span> with respect to <span class="math inline">\(P\)</span>. The valley width weighting function <span class="math inline">\(wt_D\)</span> over an interval <span class="math inline">\(P_i\)</span> to <span class="math inline">\(P_{i + 1}\)</span> along <span class="math inline">\(P\)</span> is:</p>
<p><span class="math display">\[ wt_D (P_i, P_{i+1}) = \frac{F_D (P_{i+1}) - F_D (P_i)}{F_P (P_{i+1}) - F_P (P_i)} \]</span></p>
<p>Using <span class="math inline">\(K\)</span> for the ratio of <span class="math inline">\(P/k_s\)</span>, let <span class="math inline">\(F_D(K_0)\)</span> be the CDF of <span class="math inline">\(D\)</span> with respect to <span class="math inline">\(P/k_s\)</span>. The <span class="math inline">\(D_K\)</span> weighting function <span class="math inline">\(wt_{D_K}\)</span> over an interval <span class="math inline">\(K_i\)</span> to <span class="math inline">\(K_{i + 1}\)</span> along <span class="math inline">\(K\)</span> is:</p>
<p><span class="math display">\[ wt_{D_K} (K_i, K_{i+1}) = \frac{F_D (K_{i+1}) - F_D (K_i)}{F_K (K_{i+1}) - F_K (K_i)} \]</span></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">
<span class="co"># cdf of top width by prob index</span>
top_p_cdf &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/vector">vector</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/length">length</a></span>(p_index), <span class="dt">mode =</span> <span class="st">'numeric'</span>)
<span class="cf">for</span> (i <span class="cf">in</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/seq">seq_along</a></span>(top_p_cdf))  {
  top_p_cdf[i] &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/sum">sum</a></span>(creeks<span class="op">$</span>valley_width[creeks<span class="op">$</span>DebrisFlow <span class="op">&lt;=</span><span class="st"> </span>p_index[i]]) <span class="op">/</span>
<span class="st">    </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/sum">sum</a></span>(creeks<span class="op">$</span>valley_width)
}

<span class="co"># change in top width cdf per change in index</span>
delta_p_top &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/vector">vector</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/length">length</a></span>(p_index), <span class="dt">mode =</span> <span class="st">'numeric'</span>)
<span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">2</span><span class="op">:</span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/length">length</a></span>(delta_p_top))  {
  delta_p_top[i] &lt;-<span class="st"> </span>top_p_cdf[i] <span class="op">-</span><span class="st"> </span>top_p_cdf[i<span class="op">-</span><span class="dv">1</span>]
}

<span class="co"># change in top width cdf per change in del prob cdf</span>
top_p_wt &lt;-<span class="st"> </span>delta_p_top <span class="op">/</span><span class="st"> </span>delta_p

<span class="co"># same process for k index</span>
top_k_cdf &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/vector">vector</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/length">length</a></span>(k_index), <span class="dt">mode =</span> <span class="st">'numeric'</span>)
<span class="cf">for</span> (i <span class="cf">in</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/seq">seq_along</a></span>(top_k_cdf))  {
  top_k_cdf[i] &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/sum">sum</a></span>(creeks<span class="op">$</span>valley_width[creeks<span class="op">$</span>p_ks <span class="op">&lt;=</span><span class="st"> </span>k_index[i]]) <span class="op">/</span>
<span class="st">    </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/sum">sum</a></span>(creeks<span class="op">$</span>valley_width)
}

delta_k_top &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/vector">vector</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/length">length</a></span>(k_index), <span class="dt">mode =</span> <span class="st">'numeric'</span>)
<span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">2</span><span class="op">:</span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/length">length</a></span>(delta_k_top))  {
  delta_k_top[i] &lt;-<span class="st"> </span>top_k_cdf[i] <span class="op">-</span><span class="st"> </span>top_k_cdf[i<span class="op">-</span><span class="dv">1</span>]
}

top_k_wt &lt;-<span class="st"> </span>delta_k_top <span class="op">/</span><span class="st"> </span>delta_k

<span class="kw"><a href="https://www.rdocumentation.org/packages/graphics/topics/plot">plot</a></span>(creeks<span class="op">$</span>DebrisFlow, top_p_wt, <span class="dt">pch =</span> <span class="dv">20</span>, 
     <span class="dt">col =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/grDevices/topics/rgb">rgb</a></span>(<span class="dt">red=</span>.<span class="dv">5</span>, <span class="dt">green=</span><span class="dv">0</span>, <span class="dt">blue=</span>.<span class="dv">7</span>, <span class="dt">alpha=</span>.<span class="dv">01</span>),
     <span class="dt">xlab =</span> <span class="st">'Delivery Probability'</span>, <span class="dt">ylab =</span> <span class="st">'wt_D'</span>)
<span class="kw"><a href="https://www.rdocumentation.org/packages/graphics/topics/points">points</a></span>(creeks<span class="op">$</span>DebrisFlow[creeks<span class="op">$</span>name <span class="op">==</span><span class="st"> 'knowles'</span>], 
       top_p_wt[creeks<span class="op">$</span>name <span class="op">==</span><span class="st"> 'knowles'</span>], <span class="dt">pch =</span> <span class="dv">20</span>,
       <span class="dt">col =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/grDevices/topics/rgb">rgb</a></span>(<span class="dt">red=</span><span class="dv">1</span>, <span class="dt">green=</span><span class="dv">0</span>, <span class="dt">blue=</span>.<span class="dv">2</span>, <span class="dt">alpha=</span>.<span class="dv">1</span>))
<span class="kw"><a href="https://www.rdocumentation.org/packages/graphics/topics/points">points</a></span>(creeks<span class="op">$</span>DebrisFlow[creeks<span class="op">$</span>name <span class="op">==</span><span class="st"> 'bear'</span>], 
       top_p_wt[creeks<span class="op">$</span>name <span class="op">==</span><span class="st"> 'bear'</span>], <span class="dt">pch =</span> <span class="dv">20</span>,
       <span class="dt">col =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/grDevices/topics/rgb">rgb</a></span>(<span class="dt">red=</span>.<span class="dv">5</span>, <span class="dt">green=</span><span class="dv">0</span>, <span class="dt">blue=</span>.<span class="dv">7</span>, <span class="dt">alpha=</span>.<span class="dv">1</span>))
<span class="kw"><a href="https://www.rdocumentation.org/packages/graphics/topics/abline">abline</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/lm">lm</a></span>(top_p_wt <span class="op">~</span><span class="st"> </span>creeks<span class="op">$</span>DebrisFlow), <span class="dt">col =</span> <span class="st">'gray'</span>)
<span class="kw"><a href="https://www.rdocumentation.org/packages/graphics/topics/legend">legend</a></span>(<span class="st">'topright'</span>, <span class="dt">legend =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">'knowles'</span>, <span class="st">'bear'</span>), <span class="dt">fill =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">'coral3'</span>, <span class="st">'purple'</span>))

<span class="kw"><a href="https://www.rdocumentation.org/packages/graphics/topics/plot">plot</a></span>(creeks<span class="op">$</span>p_ks, top_k_wt, <span class="dt">pch =</span> <span class="dv">20</span>, <span class="dt">col =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/grDevices/topics/rgb">rgb</a></span>(<span class="dt">red=</span>.<span class="dv">5</span>, <span class="dt">green=</span><span class="dv">0</span>, <span class="dt">blue=</span>.<span class="dv">7</span>, <span class="dt">alpha=</span>.<span class="dv">01</span>),
     <span class="dt">xlab =</span> <span class="st">'P/Ks'</span>, <span class="dt">ylab =</span> <span class="st">'wt_Dk'</span>)
<span class="kw"><a href="https://www.rdocumentation.org/packages/graphics/topics/points">points</a></span>(creeks<span class="op">$</span>p_ks[creeks<span class="op">$</span>name <span class="op">==</span><span class="st"> 'knowles'</span>], 
       top_k_wt[creeks<span class="op">$</span>name <span class="op">==</span><span class="st"> 'knowles'</span>], <span class="dt">pch =</span> <span class="dv">20</span>,
       <span class="dt">col =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/grDevices/topics/rgb">rgb</a></span>(<span class="dt">red=</span><span class="dv">1</span>, <span class="dt">green=</span><span class="dv">0</span>, <span class="dt">blue=</span>.<span class="dv">2</span>, <span class="dt">alpha=</span>.<span class="dv">1</span>))
<span class="kw"><a href="https://www.rdocumentation.org/packages/graphics/topics/points">points</a></span>(creeks<span class="op">$</span>p_ks[creeks<span class="op">$</span>name <span class="op">==</span><span class="st"> 'bear'</span>], 
       top_k_wt[creeks<span class="op">$</span>name <span class="op">==</span><span class="st"> 'bear'</span>], <span class="dt">pch =</span> <span class="dv">20</span>,
       <span class="dt">col =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/grDevices/topics/rgb">rgb</a></span>(<span class="dt">red=</span>.<span class="dv">5</span>, <span class="dt">green=</span><span class="dv">0</span>, <span class="dt">blue=</span>.<span class="dv">7</span>, <span class="dt">alpha=</span>.<span class="dv">1</span>))
<span class="kw"><a href="https://www.rdocumentation.org/packages/graphics/topics/abline">abline</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/lm">lm</a></span>(top_k_wt <span class="op">~</span><span class="st"> </span>creeks<span class="op">$</span>p_ks), <span class="dt">col =</span> <span class="st">'gray'</span>)
<span class="kw"><a href="https://www.rdocumentation.org/packages/graphics/topics/legend">legend</a></span>(<span class="st">'topright'</span>, <span class="dt">legend =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">'knowles'</span>, <span class="st">'bear'</span>), <span class="dt">fill =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">'coral3'</span>, <span class="st">'purple'</span>))</code></pre></div>
<p><img src="summer2019_update_files/figure-html/unnamed-chunk-11-1.png" width="700"><img src="summer2019_update_files/figure-html/unnamed-chunk-11-2.png" width="700"></p>
</div>
<div id="next-steps" class="section level2">
<h2 class="hasAnchor">
<a href="#next-steps" class="anchor"></a>Next Steps</h2>
<ul>
<li>Georeference Lancaster transect data for Cedar, Hoffman and Golden Ridge Creeks.</li>
<li>Georeference radiocarbon sites along creeks.
<ul>
<li>Survey data includes strat columns and fraction debris flow.</li>
</ul>
</li>
<li>Weight delivery probabilities at radiocarbon sites by fraction debris flow.</li>
<li>Compare Lancaster transect slope data to the DEM-derived MB slope.</li>
</ul>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#summer-update">Summer Update</a></li>
      <li><a href="#millerburnett-model-output">Miller/Burnett Model Output</a></li>
      <li><a href="#georeferencing-knowles-creek">Georeferencing Knowles Creek</a></li>
      <li><a href="#georeferencing-bear-creek">Georeferencing Bear Creek</a></li>
      <li><a href="#debris-flow-residence-times">Debris Flow Residence Times</a></li>
      <li><a href="#examining-delivery-probabilities">Examining Delivery Probabilities</a></li>
      <li><a href="#weighting-delivery-probabilities">Weighting Delivery Probabilities</a></li>
      <li><a href="#next-steps">Next Steps</a></li>
      </ul>
</div>
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by Erik Rose.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.3.0.</p>
</div>
      </footer>
</div>

  

  </body>
</html>
